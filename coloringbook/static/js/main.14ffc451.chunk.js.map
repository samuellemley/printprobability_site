{"version":3,"sources":["redux/bookSlice.jsx","components/ManifestSelector.jsx","components/TopBar.jsx","components/RectSelect.jsx","redux/pagesSlice.jsx","components/MarginMarker.jsx","components/PaperScrap.jsx","rgbToLuv.js","summaries.js","components/ScrapTable.jsx","components/PaperPlot.jsx","components/OverviewPage.jsx","components/App.jsx","redux/rootReducer.jsx","redux/store.jsx","index.js"],"names":["bookSlice","createSlice","name","initialState","lib","url1","url2","manifest_url","usePercent","roundPercent","reducers","setLib","state","action","payload","setURL","setManifestURL","setIIIF","getLibAndUrls","book","_bookSlice$actions","actions","ManifestSelectorDiv","styled","div","_templateObject","_taggedTemplateLiteral","iiif_settings","ManifestSelector","props","dispatch","useDispatch","_useState","useState","_useState2","_slicedToArray","libPick","setLibPick","_useState3","_useState4","setUrl1","_useState5","_useState6","setUrl2","handleChange","event","target","value","_jsx","children","_jsxs","style","padding","onChange","type","Link","to","onClick","TopBarDiv","TopTitle","h1","_templateObject2","NavBar","_templateObject3","NavBarItem","NavLink","_templateObject4","TopBar","ClearDiv","RectSelect","canvasRef","useRef","canvasRef2","width","height","maxWH","setMaxWH","cvs_ready","setCvsReady","useSelector","imageRefs","useMemo","img_urls","map","React","createRef","join","_useState7","_useState8","numLoaded","setNumLoaded","isDown","startX","startY","endX","endY","loadListen","length","renderComposite","num","useEffect","current","getContext","fillText","max_w","Math","max","apply","_toConsumableArray","ref","max_h","cvs","cvs2","ctx","fillStyle","fillRect","newData","getImageData","i","drawImage","imgdat","j","data","min","putImageData","draw","ctx2","clearRect","beginPath","lineWidth","strokeStyle","rect","stroke","handleMouseUp","e","_getMousePosition5","getMousePosition","_getMousePosition6","left","round","right","top","bottom","recordRect","canvas","getBoundingClientRect","clientX","clientY","position","display","onMouseDown","_getMousePosition","_getMousePosition2","onMouseMove","_getMousePosition3","_getMousePosition4","onMouseUp","onMouseOut","url","crossOrigin","src","onLoad","visibility","pagesSlice","setPagesFromURLs","isSelected","index","color","setDefaultRect","forEach","page","setRect","_action$payload","id","new_rect","find","setPageColor","_action$payload2","toggleSelected","getSelectedPlotInfo","pages","filter","_pagesSlice$actions","InstructionDiv","RectLink","get_manifest_url","console","log","parseInternalResponse","resp_obj","item","parseHRCResponse","parseBLResponse","parseHarvardResponse","parseCambridgeResponse","parseIAResponse","parseFolgerResponse","extractImageUrls","url_array","canvases","images","resource","hasCambridgeDomain","indexOf","hasCmuDomain","push","MarginMarker","loaded","setLoaded","_useSelector","_useSelector2","img_list","fetchManifest","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","items","wrap","_context","prev","next","fetch","sent","status","Error","json","stop","_x","_x2","_x3","arguments","pathname","x","floor","PaperImgDiv","cancelled","PaperImg","img","_ref2","_ref3","PaperButtonImageR","_ref4","active","PaperButtonImageL","_ref5","PaperScrap","hovered","setHovered","rect_str","urlbase","split","src_url","RButtonSrc","onMouseEnter","onMouseLeave","idx","imageRef","process","editRect","rgbToLuv","rgb","xyz","y","z","d65","Xn","Yn","Zn","vR","uR","v1","u1","yR","cbrt","val","pow","L","xyzToLuv","cR","cG","cB","invCompand","c","invR","invG","invB","rgbToXyz","median","numbers","sorted","slice","sort","a","b","middle","mean","reduce","acc","cur","ImgBoxDiv","customStyles","overlay","zIndex","backgroundColor","ScrapTable","useLocation","modal","edit_idx_and_modal","setEditIdxAndModal","n_loaded","setNLoaded","processImage","image_color","Rarray","Garray","Barray","Larray","Uarray","Varray","luv","med_rgb","med_luv","mean_rgb","mean_luv","summarizeImage","image_height","naturalHeight","image_width","naturalWidth","n","textAlign","ReactModal","isOpen","onRequestClose","replaceRect","PeekImg","hiding","RadioDiv","download_data","csv","concat","csv_enc","encodeURI","link","document","createElement","setAttribute","click","PaperPlot","rectCanvasRef","data_color","setDataColor","data_summary","setDataSummary","selected_pages","handleColorChange","handleSummaryChange","plotdata","var_label","checked","for","margin","Chart","chartType","options","legend","title","colors","chartEvents","eventName","callback","selection","chartWrapper","getChart","getSelection","selectedItem","row","column","smallurl","replace","pagerect","selectImage","flex","marginLeft","Text","Typography","Title","OverviewDiv","InstructionLi","li","iiif_sources","key","library","manifest","iiif_table_cols","dataIndex","render","text","code","OverviewPage","level","Table","columns","dataSource","href","class","BodyDiv","App","className","Router","Switch","Route","exact","path","component","_objectSpread","rootReducer","combineReducers","pagesReducer","bookReducer","store","configureStore","reducer","ReactDOM","Provider","getElementById"],"mappings":"gPAKMA,EAAYC,YAAY,CAC5BC,KAAM,OACNC,aAAc,CACZC,IAAK,GACLC,KAAM,GACNC,KAAM,GACNC,aAAc,GACdC,YAAY,EACZC,cAAc,GAEhBC,SAAU,CACRC,OAAM,SAACC,EAAOC,GACZD,EAAMR,IAAMS,EAAOC,OACrB,EACAC,OAAM,SAACH,EAAOC,GACZD,EAAMP,KAAOQ,EAAOC,QAAQT,KAC5BQ,EAAOC,QAAQR,OAASM,EAAMN,KAAOO,EAAOC,QAAQR,KACtD,EACAU,eAAc,SAACJ,EAAOC,GACpBD,EAAML,aAAeM,EAAOC,OAC9B,EACAG,QAAO,SAACL,EAAMC,GACZD,EAAMJ,WAAaK,EAAOC,QAAQN,WAClCI,EAAMH,aAAeI,EAAOC,QAAQL,YACtC,KAISS,EAAgB,SAACN,GAC5B,MAAO,CAACA,EAAMO,KAAKf,IAAKQ,EAAMO,KAAKd,KAAMO,EAAMO,KAAKb,KACtD,EAEOc,EAAkDpB,EAAUqB,QAArDV,EAAMS,EAANT,OAAQI,EAAMK,EAANL,OAAwBE,GAAFG,EAAdJ,eAAuBI,EAAPH,SAE/BjB,IAAiB,Q,OC/B1BsB,EAAsBC,IAAOC,IAAGC,MAAAC,YAAA,yBAIhCC,EAAgB,SAACvB,GACrB,IAAII,GAAa,EAKjB,MAHW,OAAPJ,IACFI,GAAa,GAGb,CACEA,WAAYA,EACZC,cAPe,EAUrB,EAEe,SAASmB,EAAiBC,GAEvC,IAAMC,EAAWC,cAEjBC,EAA8BC,mBAAS,IAAGC,EAAAC,YAAAH,EAAA,GAAnCI,EAAOF,EAAA,GAAEG,EAAUH,EAAA,GAC1BI,EAAwBL,mBAAS,IAAGM,EAAAJ,YAAAG,EAAA,GAA7BjC,EAAIkC,EAAA,GAAEC,EAAOD,EAAA,GACpBE,EAAwBR,mBAAS,IAAGS,EAAAP,YAAAM,EAAA,GAA7BnC,EAAIoC,EAAA,GAAEC,EAAOD,EAAA,GAEdE,EAAe,SAACC,GACpB,IAAMC,EAASD,EAAMC,OACf5C,EAAO4C,EAAO5C,KACd6C,EAAQD,EAAOC,MAER,YAAT7C,EAAoBmC,EAAWU,GACjB,SAAT7C,EAAiBsC,EAAQO,GAChB,SAAT7C,GAAiByC,EAAQI,EAEpC,EAQA,OACEC,cAAC1B,EAAmB,CAAA2B,SACpBC,eAAA,QAAMC,MAAO,CAACC,QAAS,QAAQH,SAAA,CAC/BC,eAAA,SAAAD,SAAA,CAAO,qBAEPC,eAAA,UAAQhD,KAAK,UAAU6C,MAAOX,EAC9BiB,SAAUT,EAAaK,SAAA,CACvBD,cAAA,UAAQD,MAAM,KACdC,cAAA,UAAQD,MAAM,MAAKE,SAAC,QACpBD,cAAA,UAAQD,MAAM,KAAIE,SAAC,OACnBD,cAAA,UAAQD,MAAM,UAASE,SAAC,YACxBD,cAAA,UAAQD,MAAM,YAAWE,SAAC,cAC1BD,cAAA,UAAQD,MAAM,KAAIE,SAAC,qBACnBD,cAAA,UAAQD,MAAM,SAAQE,SAAC,WACvBD,cAAA,UAAQD,MAAM,WAAUE,SAAC,aACzBD,cAAA,UAAQD,MAAM,eAAcE,SAAC,uBAErBD,cAAA,SAEK,KAAZZ,GACCc,eAAA,OAAAD,SAAA,CACAD,cAAA,SACAA,cAAA,KAAAC,SAAG,sBAAqBD,cAAA,SACX,QAAZZ,GACCc,eAAA,KAAAD,SAAA,CAAG,0EAAuED,cAAA,SAAKA,cAAA,YAEpE,OAAZZ,GACGY,cAAA,KAAAC,SAAG,2EAEM,YAAZb,GACGY,cAAA,KAAAC,SAAG,qDAEM,cAAZb,GACGY,cAAA,KAAAC,SAAG,8CAEM,OAAZb,GACGY,cAAA,KAAAC,SAAG,0DAEM,WAAZb,GACGY,cAAA,KAAAC,SAAG,mEAEM,aAAZb,GACGY,cAAA,KAAAC,SAAG,sBAEM,iBAAZb,GACGY,cAAA,KAAAC,SAAG,kIAEPD,cAAA,SACAE,eAAA,SAAAD,SAAA,CAAO,eAEPD,cAAA,SAAO9C,KAAK,OAAOoD,KAAK,OACxBP,MAAO1C,EACPgD,SAAUT,OACF,eACK,YAAZR,GAAqC,cAAZA,GAAuC,OAAZA,GAAgC,WAAZA,GAAoC,aAAZA,GAAsC,iBAAZA,GACvHc,eAAA,SAAAD,SAAA,CAAO,eAEPD,cAAA,SAAO9C,KAAK,OAAOoD,KAAK,OAC1BP,MAAOzC,EACP+C,SAAUT,OAGZI,cAAA,SAAKA,cAAA,SACLA,cAACO,IAAI,CAACC,GAAE,SAAWP,SAACD,cAAA,UAAQS,QArEP,WACvB3B,EAASf,EAAO,CAACV,KAAMA,EAAMC,KAAMA,KACnCwB,EAASnB,EAAOyB,IAChBN,EAASb,EAAQU,EAAcS,IACjC,EAiE0Da,SAAC,+BAO7D,CCpHA,IAAMS,EAAYnC,IAAOC,IAAGC,MAAAC,YAAA,gMAYtBiC,EAASpC,IAAOqC,GAAEC,MAAAnC,YAAA,sGAOlBoC,EAAOvC,IAAOC,IAAGuC,MAAArC,YAAA,+IAYjBsC,EAAWzC,YAAO0C,IAAP1C,CAAe2C,MAAAxC,YAAA,uMAYjB,SAASyC,EAAOtC,GAK3B,OACAmB,cAACU,EAAS,CAAAT,SACdC,eAACY,EAAM,CAAAb,SAAA,CACDD,cAACW,EAAQ,CAAAV,SAAC,kBACVD,cAACgB,EAAU,CAACR,GAAG,IAAGP,SAAC,aACnBD,cAACgB,EAAU,CAACR,GAAG,YAAWP,SAAC,mBAC3BD,cAACgB,EAAU,CAACR,GAAG,QAAOP,SAAC,qBACvBD,cAACgB,EAAU,CAACR,GAAG,UAASP,SAAC,oBACzBD,cAACgB,EAAU,CAACR,GAAG,QAAOP,SAAC,kBAK7B,C,6BCzDMmB,EAAW7C,IAAOC,IAAGC,MAAAC,YAAA,6YAeZ,SAAS2C,EAAWxC,GAEjC,IAAMyC,EAAYC,mBACZC,EAAaD,mBAEnBvC,GADiBuC,mBACStC,mBAAS,CAACwC,MAAO,OAAQC,OAAQ,UAAQxC,EAAAC,YAAAH,EAAA,GACnEM,GADYJ,EAAA,GAAUA,EAAA,GACID,mBAAS,CAACwC,MAAO,KAAMC,OAAQ,QAAMnC,EAAAJ,YAAAG,EAAA,GAAxDqC,EAAKpC,EAAA,GAAEqC,EAAQrC,EAAA,GACtBE,EAAiCR,oBAAS,GAAMS,EAAAP,YAAAM,EAAA,GAAzCoC,EAASnC,EAAA,GAAEoC,EAAWpC,EAAA,GACvBlC,EAAauE,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKX,UAAU,IACvDC,EAAesE,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKV,YAAY,IAE3DuE,EAAYC,mBAChB,kBAAMpD,EAAMqD,SAASC,KAAI,kBAAKC,IAAMC,WAAW,GAAC,GAChD,CAACxD,EAAMqD,SAASI,KAAK,OAGvBC,EAAkCtD,mBAAS,GAAEuD,EAAArD,YAAAoD,EAAA,GAAtCE,EAASD,EAAA,GAAEE,EAAYF,EAAA,GAI1BG,GAAS,EACTC,EAAS,KACTC,EAAS,KACTC,EAAO,KACPC,EAAO,KAELC,EAAa,WACbP,EAAY,GAAK5D,EAAMqD,SAASe,QAClCC,IAEFR,GAAa,SAAAS,GAAG,OAAIA,EAAI,CAAC,GAC3B,EAGAC,qBAAW,WACG9B,EAAU+B,QAAQC,WAAW,MACrCC,SAAS,0BAA2B,IAAK,GAC/C,GAAG,IAGH,IAAML,EAAkB,WACtB,IAAMM,EAAQC,KAAKC,IAAGC,MAARF,KAAIG,YAAQ5B,EAAUG,KAAI,SAAC0B,GAAG,OAAKA,EAAIR,QAAQ5B,KAAK,MAC5DqC,EAAQL,KAAKC,IAAGC,MAARF,KAAIG,YAAQ5B,EAAUG,KAAI,SAAC0B,GAAG,OAAKA,EAAIR,QAAQ3B,MAAM,MAC7DqC,EAAMzC,EAAU+B,QAChBW,EAAOxC,EAAW6B,QAClBY,EAAMF,EAAIT,WAAW,MACdU,EAAKV,WAAW,MAC7BS,EAAItC,MAAQ+B,EACZO,EAAIrC,OAASoC,EACbE,EAAKvC,MAAQ+B,EACbQ,EAAKtC,OAASoC,EACdG,EAAIC,UAAY,QAChBD,EAAIE,SAAS,EAAE,EAAEX,EAAMM,GAGvB,IAFA,IAAIM,EAAUH,EAAII,aAAa,EAAE,EAAEb,EAAMM,GAEhCQ,EAAE,EAAGA,EAAEtC,EAAUiB,OAAQqB,IAAI,CACpCL,EAAIM,UAAUvC,EAAUsC,GAAGjB,QAAS,EAAE,GAItC,IAHA,IAAImB,EAASP,EAAII,aAAa,EAAE,EAAEb,EAAOM,GAGhCW,EAAI,EAAGA,EAAIL,EAAQM,KAAKzB,OAAQwB,GAAK,EAC5CL,EAAQM,KAAKD,EAAE,GAAKhB,KAAKkB,IAAIP,EAAQM,KAAKD,EAAE,GAAID,EAAOE,KAAKD,EAAE,IAC9DL,EAAQM,KAAKD,EAAE,GAAKhB,KAAKkB,IAAIP,EAAQM,KAAKD,EAAE,GAAID,EAAOE,KAAKD,EAAE,IAC9DL,EAAQM,KAAKD,EAAE,GAAKhB,KAAKkB,IAAIP,EAAQM,KAAKD,EAAE,GAAID,EAAOE,KAAKD,EAAE,IAC9DL,EAAQM,KAAKD,EAAE,GAAK,GAExB,CACAR,EAAIW,aAAaR,EAAS,EAAE,GAC5BxC,EAAS,CAACH,MAAM+B,EAAO9B,OAAQoC,IAC/BhC,GAAY,EACd,EAEM+C,EAAO,WACX,IAEMC,EADOtD,EAAW6B,QACNC,WAAW,MAE7BwB,EAAKC,UAAU,EAAE,EAAEpD,EAAMF,MAAME,EAAMD,QACrCoD,EAAKE,YACLF,EAAKG,UA7DW,EA8DhBH,EAAKI,YA/DW,UAgEhBJ,EAAKK,KARK,EAQEvC,EARF,EAQYC,EARZ,EAQsBC,EARtB,EAQ6BF,EAR7B,EAQuCG,EARvC,EAQ8CF,GACxDiC,EAAKM,QACP,EAuBMC,EAAgB,SAAAC,GACpB,GAAKzD,GACAc,EAAL,CACAA,GAAS,EACT,IAAMqB,EAAOxC,EAAW6B,QAAQkC,EACjBC,EAAiBxB,EAAMsB,GAAEG,EAAAtG,YAAAoG,EAAA,GAAvCzC,EAAI2C,EAAA,GAAE1C,EAAI0C,EAAA,GACXZ,IACA,IAAMa,EAAOjC,KAAKkC,MAAMlC,KAAKkB,IAAI/B,EAAQE,IACnC8C,EAAQnC,KAAKkC,MAAMlC,KAAKC,IAAId,EAAQE,IACpC+C,EAAMpC,KAAKkC,MAAMlC,KAAKkB,IAAI9B,EAAQE,IAElCoC,EAAO,CAACO,KAAOA,EAAME,MAAOA,EAAOE,OAD1BrC,KAAKkC,MAAMlC,KAAKC,IAAIb,EAAQE,IACc8C,IAAKA,GAE1DrI,IACF2H,EAAKO,KAAOP,EAAKO,KAAK/D,EAAMF,MAAM,IAClC0D,EAAKS,MAAQT,EAAKS,MAAMjE,EAAMF,MAAM,IACpC0D,EAAKU,IAAMV,EAAKU,IAAIlE,EAAMD,OAAO,IACjCyD,EAAKW,OAASX,EAAKW,OAAOnE,EAAMD,OAAO,IACnCjE,IACF0H,EAAKO,KAAOjC,KAAKkC,MAAMR,EAAKO,MAC5BP,EAAKS,MAAQnC,KAAKkC,MAAMR,EAAKS,OAC7BT,EAAKU,IAAMpC,KAAKkC,MAAMR,EAAKU,KAC3BV,EAAKW,OAASrC,KAAKkC,MAAMR,EAAKW,UAGlCjH,EAAMkH,WAAWZ,EAvBE,CAwBrB,EAKMK,EAAmB,SAACQ,EAAQnG,GAChC,IAAIsF,EAAOa,EAAOC,wBACZjC,EAAOxC,EAAW6B,QAGxB,MAAO,EAFCxD,EAAMqG,QAAQf,EAAKO,OAAOP,EAAKS,MAAQT,EAAKO,MAAM1B,EAAKvC,OACxD5B,EAAMsG,QAAQhB,EAAKU,MAAMV,EAAKW,OAASX,EAAKU,KAAK7B,EAAKtC,OAE/D,EAGE,OACExB,eAACkB,EAAQ,CAAAnB,SAAA,CACTD,cAAA,UAAQ6D,IAAKvC,EACbnB,MAAO,CAAEiG,SAAS,WAAY3E,MAAO,OACjC4E,QAAS,QAET,OAAU,KAGdrG,cAAA,UAAQyB,MAAO,IAAMC,OAAQ,IAAKmC,IAAKrC,EACvCrB,MAAO,CAACiG,SAAS,WAAY3E,MAAO,OAChC4E,QAAS,eAET,OAAU,GAEdC,YA5EoB,SAAAhB,GACtB,GAAKzD,EAAL,CACA,IAAMmC,EAAOxC,EAAW6B,QAAQkD,EACbf,EAAiBxB,EAAMsB,GAAEkB,EAAArH,YAAAoH,EAAA,GAA3C3D,EAAM4D,EAAA,GAAE3D,EAAM2D,EAAA,GACf7D,GAAS,EACT6C,EAAiBxB,EAAMsB,EAJD,CAKxB,EAuEMmB,YAtEkB,SAAAnB,GACtB,GAAKzD,GACAc,EAAL,CACA,IAAMqB,EAAOxC,EAAW6B,QAAQqD,EACjBlB,EAAiBxB,EAAMsB,GAAEqB,EAAAxH,YAAAuH,EAAA,GAAvC5D,EAAI6D,EAAA,GAAE5D,EAAI4D,EAAA,GAOX9B,GATmB,CAUrB,EA2DM+B,UAAWvB,EACXwB,WA/BiB,SAAAvB,GACrBD,EAAcC,EAChB,IA+BKzG,EAAMqD,SAASC,KAAI,SAAC2E,EAAIxC,GAAC,OACxBtE,cAAA,OAAK+G,YAAY,YACjBlD,IAAK7B,EAAUsC,GACf0C,IAAKF,EAELG,OAAQjE,EACR7C,MAAO,CAAC+G,WAAY,SAAUd,SAAU,UAFnCU,EAGL,MAGR,CCnMA,I,MAAMK,EAAalK,YAAY,CAC7BC,KAAM,QACNC,aAAc,GACdO,SAAU,CACR0J,iBAAgB,SAACxJ,EAAOC,GAItB,OAAOA,EAAOC,QAAQqE,KAAI,SAAC2E,EAAKxC,GAC9B,MAAO,CAAEwC,IAAKA,EAAK3B,KAAM,CAAC,EAAGkC,YAAY,EAAMC,MAAOhD,EAAGiD,MAAO,CAAC,EACnE,GAEF,EAEAC,eAAc,SAAC5J,EAAOC,GACpBD,EAAM6J,SAAQ,SAACC,GAAI,OAAKA,EAAKvC,KAAOtH,EAAOC,OAAO,GACpD,EACA6J,QAAO,SAAC/J,EAAOC,GACb,IAAA+J,EAAuB/J,EAAOC,QAAvB+J,EAAED,EAAFC,GAAIC,EAAQF,EAARE,SACElK,EAAMmK,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,QAAUO,CAAE,IAC5C1C,KAAO2C,CACd,EACAE,aAAY,SAACpK,EAAOC,GAClB,IAAAoK,EAAoBpK,EAAQC,QAArB+J,EAAEI,EAAFJ,GAAIN,EAAKU,EAALV,MACE3J,EAAMmK,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,QAAUO,CAAE,IAC5CN,MAAQA,CACf,EACAW,eAAc,SAACtK,EAAOC,GACpB,IAAM6J,EAAO9J,EAAMmK,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,QAAUzJ,EAAOC,OAAO,IAC7D4J,EAAKL,YAAcK,EAAKL,UAC1B,KAMSc,EAAsB,SAAAvK,GACjC,OAAOA,EAAMwK,MAAMC,QAAO,SAAAX,GAAI,OAAIA,EAAKL,UAAU,GACnD,EAGOiB,EAAmFnB,EAAW9I,QAAtF+I,EAAgBkB,EAAhBlB,iBAAkBI,EAAcc,EAAdd,eAAgBG,EAAOW,EAAPX,QAASO,EAAcI,EAAdJ,eAAgBF,EAAYM,EAAZN,aAE3Db,IAAkB,QCvC3BoB,EAAiBhK,IAAOC,IAAGC,MAAAC,YAAA,+LAW3B8J,GAASjK,YAAOgC,IAAPhC,CAAYsC,MAAAnC,YAAA,+KAYrB0C,GAAW7C,IAAOC,IAAGuC,MAAArC,YAAA,2XAcrB+J,GAAmB,SAACrL,EAAKC,EAAMC,GACnC,MAAY,QAARF,EACK,sDAAsDC,EAAK,IAAIC,EAAK,IAEjE,OAARF,EACK,wCAAwCC,EAAK,IAAIC,EAAK,iBAEnD,YAARF,EACK,0CAA0CC,EAEvC,cAARD,EACK,mCAAmCC,EAEhC,OAARD,EACK,iCAAiCC,EAAK,iBAEnC,WAARD,EACK,+CAA+CC,EAAK,YAElD,YAAPD,GAGO,gBAAPA,EAFKC,OAKTqL,QAAQC,IAAI,2BAEd,EAEMC,GAAwB,SAACC,GAE7B,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,GAE3G,EACMC,GAAmB,SAACF,GAExB,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAG,MAAM,GAE/F,EACME,GAAkB,SAACH,GAEvB,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,GAE3G,EACMG,GAAuB,SAACJ,GAE5B,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,GAE3G,EACMI,GAAyB,SAACL,GAI9B,OAHkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,IAC5E3G,KAAI,SAAC2G,GAAI,OAAKA,EAAK,0BAA0B,GAG5E,EACMK,GAAkB,SAACN,GAEvB,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,GAE3G,EACMM,GAAsB,SAACP,GAE3B,OADkBA,EAAoB,UAAE,GAAa,SAAE1G,KAAI,SAAC2G,GAAI,OAAKA,EAAa,OAAE,GAAa,SAAE,MAAM,GAE3G,EAGMO,GAAmB,SAACR,GACxB,IAAIS,EAAY,GAChB,GAAIT,EAAoB,WAAKA,EAAoB,UAAE,GAAa,SAE9D,IADA,IAAMU,EAAWV,EAAoB,UAAE,GAAa,SAC3CvE,EAAI,EAAGA,EAAIiF,EAAStG,OAAQqB,IAAK,CACxC,IAAMkF,EAASD,EAASjF,GAAW,OACnC,GAAIkF,GAAUA,EAAOvG,OAAS,EAAG,CAC/B,IAAMwG,EAAWD,EAAO,GAAa,SACrC,GAAIC,EAAU,CACZ,IAAI3C,EAAM2C,EAAS,QAAUD,EAAO,GAAG,OACvC,GAAI1C,EAAK,CACP,IACM4C,GAAuD,IAAlC5C,EAAI6C,QADP,aAGlBC,GAA2C,IAA5B9C,EAAI6C,QADP,mBAMdD,EACF5C,GAAO,2BACE8C,IACT9C,EAAM2C,EAAkB,QAAE,OAC1B3C,GAAO,4BAETwC,EAAUO,KAAK/C,EACjB,CACF,CACF,CACF,CAEF,OAAOwC,CACT,EAEe,SAASQ,GAAajL,GACnC,IAAAG,EAA4BC,oBAAS,GAAMC,EAAAC,YAAAH,EAAA,GAApC+K,EAAM7K,EAAA,GAAE8K,EAAS9K,EAAA,GACxBI,EAAwBL,mBAAS,CAAC,GAAEM,EAAAJ,YAAAG,EAAA,GAA7B6F,EAAI5F,EAAA,GAAEoI,EAAOpI,EAAA,GAEpB0K,EAA0BlI,YAAY7D,GAAcgM,EAAA/K,YAAA8K,EAAA,GAA7C7M,EAAG8M,EAAA,GAAE7M,EAAI6M,EAAA,GAAE5M,EAAI4M,EAAA,GAChBC,EAAWpI,aAAY,SAAAnE,GAAK,OAAIA,EAAMwK,MAAMjG,KAAI,SAAAuF,GAAI,OAAIA,EAAKZ,GAAG,GAAC,IAQjEhI,GAPaiD,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKX,UAAU,IAO5CuB,eASjBqE,qBAAU,WACR,IAAMgH,EAAa,eAAAC,EAAAC,YAAAC,cAAAC,MAAG,SAAAC,EAAOrN,EAAKC,EAAMC,GAAI,IAAAC,EAAAmN,EAAA7B,EAAA8B,EAAA,OAAAJ,cAAAK,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAEC,OADrCxN,EAAekL,GAAiBrL,EAAKC,EAAMC,GACjDoL,QAAQC,IAAI,eAAiBpL,GAAcsN,EAAAE,KAAA,EACpBC,MAAMzN,GAAc,KAAD,EAA5B,MAARmN,EAAQG,EAAAI,MACDC,QAAU,KAAG,CAAAL,EAAAE,KAAA,QACuB,MAA/CrC,QAAQC,IAAI,iBAAmB+B,EAASQ,QAClC,IAAIC,MAAO,oCAAoC,KAAD,SAAAN,EAAAE,KAAA,GAG/BL,EAASU,OAAO,KAAD,GAAhCvC,EAAQgC,EAAAI,KACVN,EAAQ,GACA,QAARvN,EACFuN,EAAQ5B,GAAiBF,GACT,MAAPzL,EACTuN,EAAQ3B,GAAgBH,GACR,WAAPzL,EACTuN,EAAQ1B,GAAqBJ,GACb,YAAPzL,EACTuN,EAAQ/B,GAAsBC,GACd,gBAAPzL,EACTuN,EAAQtB,GAAiBR,GACT,aAAPzL,EACTuN,EAAQzB,GAAuBL,GACf,MAAPzL,EACTuN,EAAQxB,GAAgBN,GACR,UAAPzL,IACTuN,EAAQvB,GAAoBP,IAM9B/J,EAASsI,EAAiBuD,IAE1BX,GAAU,GAAM,yBAAAa,EAAAQ,OAAA,GAAAZ,EAAA,KACjB,gBAnCkBa,EAAAC,EAAAC,GAAA,OAAAnB,EAAA1G,MAAA,KAAA8H,UAAA,KAoCnBrB,EAAchN,EAAKC,EAAMC,EAC3B,GAAG,CAACF,EAAKC,EAAMC,IAGD6H,EAAKU,IACFV,EAAKW,OACPX,EAAKO,KACJP,EAAKS,MAInB,OACE1F,eAAA,OAAAD,SAAA,EACE8J,GACA/J,cAACuI,EAAc,CAAAtI,SAAC,8FAIjB8J,GACC7J,eAACkB,GAAQ,CAAAnB,SAAA,CACTC,eAACqI,EAAc,CAAAtI,SAAA,CAAC,yOAEhBD,cAAA,SAAKA,cAAA,SACLA,cAACwI,GAAQ,CACThI,GAAI,CACFkL,SAAS,WACGzL,SAAE,0BAIhBD,cAACqB,EAAU,CAAC0E,WA1EC,SAACZ,GAClBrG,EAAS0I,EAAerC,IACxBwC,EAAQxC,EACV,EAwEM1H,aAAqB,QAAPL,EACd8E,SAAUiI,EAAS9B,QAAO,SAACsD,EAAErH,GAAC,OAE1BA,EAnFQ,GAmFSb,KAAKmI,OAAOzB,EAASlH,OAAS,GAAa,KAAmB,CAAC,WAW5F,C,oDC9OM4I,GAActN,IAAOC,IAAGC,QAAAC,YAAA,mJAO1B,SAAA2L,GAAW,OAAAA,EAATyB,WAAyB,6DAI5B,IAGGC,GAAWxN,IAAOyN,IAAGnL,QAAAnC,YAAA,sEAIvB,SAAAuN,GAAW,OAAAA,EAATH,WAAwB,6GAM3B,IACD,SAAAI,GAAW,OAAAA,EAATJ,WAAyB,uBAE1B,IAEGK,GAAoB5N,IAAOyN,IAAGjL,QAAArC,YAAA,mFAKhC,SAAA0N,GAAQ,OAAAA,EAANC,QAAmB,6BAEtB,IAEGC,GAAoB/N,IAAOyN,IAAG9K,QAAAxC,YAAA,gFAKlC,SAAA6N,GAAQ,OAAAA,EAANF,QAAmB,6BAEpB,IAGY,SAASG,GAAW3N,GAEjC,IAAMC,EAAWC,cAEjBC,EAA8BC,oBAAS,GAAMC,EAAAC,YAAAH,EAAA,GAAtCyN,EAAOvN,EAAA,GAAEwN,EAAUxN,EAAA,GAQpB1B,EAAauE,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKX,UAAU,IACvDsO,EAAY/J,aAAY,SAAAnE,GAAK,OAAMA,EAAMwK,MAAML,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,OAASzI,EAAMyI,KAAK,IAAED,UAAW,IAClGlC,EAAOpD,aAAY,SAAAnE,GAAK,OAAIA,EAAMwK,MAAML,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,OAASzI,EAAMyI,KAAK,IAAEnC,IAAI,IAEpF2B,EAAM/E,aAAY,SAAAnE,GAAK,OAAIA,EAAMwK,MAAML,MAAK,SAAAL,GAAI,OAAIA,EAAKJ,OAASzI,EAAMyI,KAAK,IAAER,GAAG,IAGlF6F,GAFM5K,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKf,GAAG,KAE7BI,EAAa,OAAS,IAAM,CAAC2H,EAAKO,KAAMP,EAAKU,IAAKV,EAAKS,MAAMT,EAAKO,KAAMP,EAAKW,OAAOX,EAAKU,KAAKvD,KAAK,MACjHsK,EAAU9F,EAAI+F,MAAM,QAAQ,GAE1BC,GADNF,GAAiD,MAA5BA,EAAQA,EAAQ3J,OAAO,GAAW,GAAK,KAClC0J,EAAW,sBAG/BI,EAAajB,EAAY,sBAAwB,yBAErD,OACE5L,eAAC2L,GAAW,CACZmB,aAAc,kBAAMN,GAAW,EAAK,EACpCO,aAAc,kBAAMP,GAAW,EAAM,EACrCZ,UAAWA,EAAU7L,SAAA,CAErBD,cAAC+L,GAAQ,CAAmBmB,IAAKrO,EAAMyI,MAAOzD,IAAKhF,EAAMsO,SACzDpG,YAAY,YACZC,IAAK8F,EACLhB,UAAWA,EACX7E,OAAQpI,EAAMuO,SAJCvO,EAAMyI,OAMrBtH,cAACsM,GAAiB,CAACD,OAAQI,EAAShM,QAAS5B,EAAMwO,SAAU5L,MAAM,OAAOC,OAAO,OAAOsF,IAAI,yBAC5FhH,cAACmM,GAAiB,CAACE,OAAQI,EAAShM,QAhCpB,SAAC6E,GACnBxG,EAASoJ,EAAerJ,EAAMyI,OAChC,EA8B8D7F,MAAM,OAAOC,OAAO,OAAOsF,IAAK+F,MAEhG,CCzCe,SAASO,GAASC,GAC/B,OA9BK,SAAkBC,GACvB,IAAM7B,EAAI6B,EAAI,GACRC,EAAID,EAAI,GACRE,EAAIF,EAAI,GACRG,EAAM,CAAC,MAAO,IAAK,OAGnBC,EAAKD,EAAI,GACTE,EAAKF,EAAI,GACTG,EAAKH,EAAI,GACTI,EAAK,EAAIF,GAAMD,EAAK,GAAKC,EAAK,EAAIC,GAClCE,EAAK,EAAIJ,GAAMA,EAAK,GAAKC,EAAK,EAAIC,GAExC,GAAU,IAANnC,GAAiB,IAAN8B,GAAiB,IAANC,EACxB,MAAO,CAAC,EAAG,EAAG,GAEhB,IAAMO,EAAK,EAAIR,GAAK9B,EAAI,GAAK8B,EAAI,EAAIC,GAC/BQ,EAAK,EAAIvC,GAAKA,EAAI,GAAK8B,EAAI,EAAIC,GAC/BS,EAAKV,EAAII,EACTO,EAAqB,MAAb3K,KAAK2K,KACjB3K,KAAK2K,KACL,SAACC,GAAG,OAAK5K,KAAK6K,IAAID,EAAK,EAAI,EAAG,EAC1BE,EAAKJ,EAjBC,IAAM,MAiBK,IAAMC,EAAKD,EAAI,EAAI,GAAK,GAhBnC,MAAQ,GAgBsCA,EAI1D,MAAO,CAACI,EAAI,EAHF,GAAKA,GAAKL,EAAKF,GAGN,EAFT,GAAKO,GAAKN,EAAKF,GAEC,EAC5B,CAGSS,CAtDF,SAAkBjB,GAEvB,IAAMkB,EAAKlB,EAAI,GAAK,IACdmB,EAAKnB,EAAI,GAAK,IACdoB,EAAKpB,EAAI,GAAK,IAKdqB,EAAa,SAACC,GAAC,OAAMA,GAAK,OAC9BA,EAAI,MACJpL,KAAK6K,KAAKO,EAAI,MAAS,MAAO,IAAK,EAC/BC,EAAOF,EAAWH,GAClBM,EAAOH,EAAWF,GAClBM,EAAOJ,EAAWD,GAOxB,MAAO,CAAK,KALF,MAASG,EAAO,MAASC,EAAO,MAASC,GAKjC,EAAO,KAJf,MAASF,EAAO,MAASC,EAAO,MAASC,GAIpB,EAAO,KAH5B,MAASF,EAAO,MAASC,EAAO,MAASC,GAGP,EAC9C,CAgCkBC,CAAS1B,GAC3B,CC1DO,SAAS2B,GAAOC,GACnB,IAAMC,EAASD,EAAQE,QAAQC,MAAK,SAACC,EAAGC,GAAC,OAAKD,EAAIC,CAAC,IAC7CC,EAAShM,KAAKmI,MAAMwD,EAAOnM,OAAS,GAE1C,OAAImM,EAAOnM,OAAS,IAAM,GACdmM,EAAOK,EAAS,GAAKL,EAAOK,IAAW,EAG5CL,EAAOK,EAClB,CAEO,SAASC,GAAKP,GACjB,OAAOA,EAAQQ,QAAO,SAACC,EAAKC,GAAG,OAAKD,EAAMC,CAAG,IAAEV,EAAQlM,MAC3D,CCCA,IAAM6M,GAAYvR,IAAOC,IAAGC,QAAAC,YAAA,2KAStBqR,GAAe,CACnBC,QAAS,CAACC,OAAQ,IAClBC,gBAAiB,SAGb3H,GAAiBhK,IAAOC,IAAGqC,QAAAnC,YAAA,+LAWlB,SAASyR,GAAWtR,GAEjC,IAAMC,EAAWC,cAIXuC,GAFW8O,eAEC7O,oBAElBvC,EAAiDC,mBAAS,CAACoR,OAAO,EAAO/I,MAAO,OAAMpI,EAAAC,YAAAH,EAAA,GAA/EsR,EAAkBpR,EAAA,GAAEqR,EAAkBrR,EAAA,GAC7CI,EAA+BL,mBAAS,GAAEM,EAAAJ,YAAAG,EAAA,GAAnCkR,EAAQjR,EAAA,GAAEkR,EAAUlR,EAAA,GAErBnC,EAAM2E,aAAY,SAAAnE,GAAK,OAAIA,EAAMO,KAAKf,GAAG,IACzC8E,EAAWH,aAAY,SAAAnE,GAAK,OAAIA,EAAMwK,MAAMjG,KAAI,SAAAuF,GAAI,OAAIA,EAAKZ,GAAG,GAAC,IA8BjE9E,EAAYC,mBAChB,kBAAMC,EAASC,KAAI,kBAAKC,IAAMC,WAAW,GAAC,GAC1C,CAACH,EAASe,OAAQf,IA4DdwO,EAAe,SAACpM,GACpB,IACMqM,EA1Ce,SAACjM,GAGtB,IAFA,IAAIkM,EAAS,GAAQC,EAAS,GAAQC,EAAS,GAC3CC,EAAS,GAAQC,EAAS,GAAQC,EAAS,GACtC3M,EAAI,EAAGA,EAAII,EAAKzB,OAAQqB,GAAK,EAAG,CACvC,IAAIiJ,EAAM7I,EAAK2K,MAAM/K,EAAGA,EAAE,GAC1BsM,EAAO/G,KAAK0D,EAAI,IAChBsD,EAAOhH,KAAK0D,EAAI,IAChBuD,EAAOjH,KAAK0D,EAAI,IAEhB,IAAI2D,EAAM5D,GAASC,GACnBwD,EAAOlH,KAAKqH,EAAI,IAChBF,EAAOnH,KAAKqH,EAAI,IAChBD,EAAOpH,KAAKqH,EAAI,GAClB,CACA,MAAO,CACLC,QAAS,CAACjC,GAAO0B,GAAS1B,GAAO2B,GAAS3B,GAAO4B,IACjDM,QAAS,CAAClC,GAAO6B,GAAS7B,GAAO8B,GAAS9B,GAAO+B,IACjDI,SAAU,CAAC3B,GAAKkB,GAASlB,GAAKmB,GAASnB,GAAKoB,IAC5CQ,SAAU,CAAC5B,GAAKqB,GAASrB,GAAKsB,GAAStB,GAAKuB,IAEhD,CAsBsBM,CAvDD,SAACpE,GACpB,IAAMpJ,EAAMzC,EAAU+B,QAChBY,EAAMF,EAAIT,WAAW,MACrBkO,EAAerE,EAAS9J,QAAQoO,cAChCC,EAAcvE,EAAS9J,QAAQsO,aAKrC,OAJA5N,EAAItC,MAAQiQ,EACZ3N,EAAIrC,OAAS8P,EACbvN,EAAIM,UAAU4I,EAAS9J,QAAS,EAAE,GAClBY,EAAII,aAAa,EAAE,EAAEqN,EAAaF,GACnC9M,IAEjB,CA2CeL,CAAarC,EAAUsC,KAEpCxF,EAASkJ,EAAa,CAACH,GAAIvD,EAAGiD,MAAOoJ,KACrCF,GAAY,SAAAmB,GAAC,OAAIA,EAAI,CAAC,GACxB,EAWA,OACE1R,eAAA,OAAAD,SAAA,CACAC,eAAA,OAAKC,MAAO,CAAC0R,UAAW,UAAU5R,SAAA,CAClCC,eAACqI,GAAc,CAAAtI,SAAA,CAAC,kMAC+KD,cAAA,SAAKA,cAAA,SAAK,wCAEpKA,cAAA,SAAKA,cAAA,SACzCwQ,GAAYtO,EAASe,QACtBjD,cAACO,IAAI,CAACC,GAAI,CACRkL,SAAS,UACTzL,SACDD,cAAA,UAAAC,SAAQ,gCACRuQ,EAAWtO,EAASe,QACjBjD,cAAA,KAAAC,SAAG,sDAIPD,cAAA,OAAAC,SACKD,cAAC8P,GAAS,CAAA7P,SACZ+B,EAAUG,KAAI,SAAC0B,EAAKS,GACnB,OAAOtE,cAACwM,GAAU,CAASlF,MAAOhD,EAAG6I,SAAUtJ,EAC/CuJ,QAAW,kBAAMsD,EAAapM,EAAE,EAChC+I,SAAY,kBA3BD,SAAC/I,GACdiM,EAAmB,CAACF,OAAO,EAAM/I,MAAOhD,GAC1C,CAyBsB+I,CAAS/I,EAAE,GAFLA,EAGrB,QAOPtE,cAAA,UAAQ6D,IAAKvC,EAAWG,MAAM,QAAQC,OAAO,QAAQvB,MAAO,CAAC+G,WAAY,eAEzElH,cAAC8R,KAAU,CAACC,OAAQzB,EAAmBD,MACvClQ,MAAO4P,GACPiC,eA3CuB,WACvBzB,EAAmB,CAACF,OAAO,EAAO/I,MAAO,MAC3C,EAyCmCrH,SAEjCD,cAACqB,EAAU,CACX7D,WAAYqB,EAAMrB,YAAsB,QAARJ,EAChCK,aAAsB,QAARL,EACd8E,SAAU,CAACA,EAASoO,EAAmBhJ,QACvCvB,WAAY,SAACZ,GAAI,OAjHC,SAACb,EAAGa,GACtBrG,EAAS6I,EAAQ,CAACE,GAAIvD,EAAGwD,SAAU3C,IACrC,CA+GwB8M,CAAY3B,EAAmBhJ,MAAOnC,EAAK,QAMrE,C,uBCjMM+M,GAAU3T,IAAOyN,IAAGvN,QAAAC,YAAA,iBACtB,SAAA2L,GAAS,OAAAA,EAAN8H,QACG,6BAGP,IAGG5J,GAAiBhK,IAAOC,IAAGqC,QAAAnC,YAAA,8LAU3B0T,GAAW7T,IAAOC,IAAGuC,QAAArC,YAAA,oKASrB2T,GAAgB,SAACjK,GACrB,IAAIkK,EACF,sIAqBFA,EAAM,gCApBNA,GAEElK,EACGjG,KACC,SAACwJ,GAAC,MACA,CACEA,EAAErE,MACFqE,EAAExG,KAAKO,KACPiG,EAAExG,KAAKS,MACP+F,EAAExG,KAAKW,OACP6F,EAAExG,KAAKU,KAAG0M,OAAA3O,YACP+H,EAAEpE,MAAM6J,SAAOxN,YACf+H,EAAEpE,MAAM4J,SAAOvN,YACf+H,EAAEpE,MAAM+J,UAAQ1N,YAChB+H,EAAEpE,MAAM8J,UAAQ,CACnB1F,EAAE7E,MACFxE,KAAK,KAAO,IAAI,IAErBqN,QAAO,SAACC,EAAKC,GAAG,OAAKD,EAAMC,CAAG,KAGnC,IAAM2C,EAAUC,UAAUH,GACpBI,EAAOC,SAASC,cAAc,KACpCF,EAAKG,aAAa,OAAQL,GAC1BE,EAAKG,aAAa,WALD,cAMjBH,EAAKI,OACP,EAEe,SAASC,GAAUlU,GAChC,IAAMsO,EAAW5L,mBACXyR,EAAgBzR,mBAChB/D,EAAauE,aAAY,SAACnE,GAAK,OAAKA,EAAMO,KAAKX,UAAU,IAI/DwB,EAAmCC,mBAAS,OAAMC,EAAAC,YAAAH,EAAA,GAA3CiU,EAAU/T,EAAA,GAAEgU,EAAYhU,EAAA,GAC/BI,EAAuCL,mBAAS,OAAMM,EAAAJ,YAAAG,EAAA,GAA/C6T,EAAY5T,EAAA,GAAE6T,EAAc7T,EAAA,GACnCE,EAAmCR,mBAAS,SAAQS,EAAAP,YAAAM,EAAA,GAI9C4T,GAJW3T,EAAA,GAAcA,EAAA,GAEnBqC,aAAY,SAACnE,GAAK,OAAKA,EAAMO,KAAKf,GAAG,IAE1B2E,YAAYoG,IAE7BmL,EAAoB,SAAChO,GACzB4N,EAAa5N,EAAExF,OAAOC,MACxB,EACMwT,EAAsB,SAACjO,GAC3B8N,EAAe9N,EAAExF,OAAOC,MAC1B,EAgDMyT,EAAWH,EAAelR,KAAI,SAACuF,EAAMpD,GAAC,OAC1CA,GAACiO,OAAA3O,YACE8D,EAAKH,MAAM4L,EAAe,IAAMF,IAAW,IAE1CQ,EAA2B,QAAfR,EAAuB,CAAC,IAAK,IAAK,KAAO,CAAC,IAAK,IAAK,KAEtE,OACEjT,cAAA,OAAKG,MAAO,CAAEC,QAAS,QAASH,SAC7BoT,EAAepQ,OAAS,GACvB/C,eAAA,OAAAD,SAAA,CACEC,eAACqI,GAAc,CAAAtI,SAAA,CAAC,gEAEdD,cAAA,SACAA,cAAA,SAAM,2BACmB,IACzBA,cAAA,UAAQS,QAAS,kBAAM4R,GAAcgB,EAAe,EAACpT,SAAC,SACtDD,cAAA,SACAE,eAAA,OACEC,MAAO,CACLkG,QAAS,OACT,kBAAmB,eACnB,aAAc,QACdpG,SAAA,CAEFC,eAACkS,GAAQ,CAAAnS,SAAA,CACPD,cAAA,SACEM,KAAK,QACLP,MAAM,MACN8H,GAAG,MACHxH,SAAUiT,EACVpW,KAAK,cACLwW,QAAuB,OAAdT,EAAsB,UAAY,KAE7CjT,cAAA,SAAO2T,IAAI,MAAK1T,SAAC,QAAW,iBAE5BD,cAAA,SACEM,KAAK,QACLP,MAAM,MACN8H,GAAG,MACHxH,SAAUiT,EACVpW,KAAK,cACLwW,QAAuB,OAAdT,EAAsB,UAAY,KAE7CjT,cAAA,SAAO2T,IAAI,MAAK1T,SAAC,WAGnBC,eAACkS,GAAQ,CAAAnS,SAAA,CACPD,cAAA,SACEM,KAAK,QACLP,MAAM,MACN8H,GAAG,MACHxH,SAAUkT,EACVrW,KAAK,gBACLwW,QAAyB,OAAhBP,EAAwB,UAAY,KAE/CnT,cAAA,SAAO2T,IAAI,MAAK1T,SAAC,WAAc,iBAE/BD,cAAA,SACEM,KAAK,QACLP,MAAM,OACN8H,GAAG,OACHxH,SAAUkT,EACVrW,KAAK,gBACLwW,QAAyB,OAAhBP,EAAwB,UAAY,KAE/CnT,cAAA,SAAO2T,IAAI,OAAM1T,SAAC,kBAaxBC,eAAA,OACEC,MAAO,CAAEkG,QAAS,OAAQuN,OAAQ,OAAQ,YAAa,QAAS3T,SAAA,CAEhED,cAAA,OAAAC,SACED,cAAC6T,KAAK,CACJpS,MAAO,QACPC,OAAQ,QACRoS,UAAU,UACVpP,KAAI,EAAI,QAAM6N,OAAKkB,IAASlB,OAAA3O,YAAM4P,IAClCO,QAAS,CACPC,OAAQ,CAAE5N,SAAU,UACpB6N,MAAO,OACPC,OAAQ,CAAC,UAAW,UAAW,YAEjCC,YAAa,CACX,CACEC,UAAW,SACXC,SAAU,SAAApI,GAAuB,IAEzBqI,EAFiBrI,EAAZsI,aACgBC,WACHC,eAIxB,GAHyB,IAArBH,EAAUrR,SAxGhCkK,EAAS9J,QAAQ2D,IAAM,IA2GoB,IAArBsN,EAAUrR,OAAc,CAC1B,IAAOyR,EAAPvV,YAAuBmV,EAAS,GAAb,GAEXK,EAAgBD,EAAhBC,IAAgBD,EAAXE,QAnJf,SAACtQ,GACnB,IAGMuQ,EADUxB,EAAe/O,GAAGwC,IACTgO,QAAQ,YAAa,aAC9C3H,EAAS9J,QAAQ2D,IAAM6N,EACvB,IAAME,EAAW1B,EAAe/O,GAAGa,KAE7BpB,EAAMiP,EAAc3P,QACpBY,EAAMF,EAAIT,WAAW,MACrBkO,EAAerE,EAAS9J,QAAQoO,cAChCC,EAAcvE,EAAS9J,QAAQsO,aACrC5N,EAAItC,MAAQiQ,EACZ3N,EAAIrC,OAAS8P,EACThU,IACFuX,EAASlP,IAAMpC,KAAKkC,MAAOoP,EAASlP,IAAM2L,EAAgB,KAC1DuD,EAASjP,OAASrC,KAAKkC,MAAOoP,EAASjP,OAAS0L,EAAgB,KAChEuD,EAASrP,KAAOjC,KAAKkC,MAAOoP,EAASrP,KAAOgM,EAAe,KAC3DqD,EAASnP,MAAQnC,KAAKkC,MAAOoP,EAASnP,MAAQ8L,EAAe,MAG/DhJ,QAAQC,IAAI,WAAYoM,GACxB9Q,EAAIe,YACJf,EAAIgB,UAtBc,EAuBlBhB,EAAIiB,YAtBc,UAuBlBjB,EAAIkB,KACF4P,EAASrP,KACTqP,EAASlP,IACTkP,EAASnP,MAAQmP,EAASrP,KAC1BqP,EAASjP,OAASiP,EAASlP,KAE7B5B,EAAImB,QAGN,CAkHsB4P,CAAYL,EACd,CACF,QAKRzU,eAAA,OAAKC,MAAO,CAAEiG,SAAU,YAAanG,SAAA,CACnCD,cAACkS,GAAO,CACNrO,IAAKsJ,EACLnG,IAAI,GACJ7G,MAAO,CACLiG,SAAU,WACV6O,KAAM,EACNxT,MAAO,QACPyT,WAAY,UAIhBlV,cAAA,UACEyB,MAAO,GACPC,OAAQ,GACRmC,IAAKmP,EACL7S,MAAO,CAAEiG,SAAU,WAAY6J,OAAQ,EAAGiF,WAAY,oBAQtE,C,iCC1QQC,GAAgBC,KAAhBD,KAAME,GAAUD,KAAVC,MAERC,GAAc/W,IAAOC,IAAGC,QAAAC,YAAA,kFAgBxB6W,GAAgBhX,IAAOiX,GAAE3U,QAAAnC,YAAA,uDAKzB+W,GAAe,CACnB,CACFC,IAAK,EACLC,QAAS,kBACTC,SAAU,0EAER,CACFF,IAAK,EACLC,QAAS,YACTC,SAAU,6CAER,CACFF,IAAK,EACLC,QAAS,6BACTC,SAAU,kEAER,CACFF,IAAK,EACLC,QAAS,mCACTC,SAAU,2EAER,CACFF,IAAK,EACLC,QAAS,UACTC,SAAU,oDAER,CACFF,IAAK,EACLC,QAAS,mBACTC,SAAU,0DAIJC,GAAkB,CACtB,CACE5B,MAAO,UACP6B,UAAW,UACXJ,IAAK,WAEP,CACEzB,MAAO,kBACP6B,UAAW,WACXJ,IAAK,WACLK,OAAQ,SAAAC,GAAI,OAAIhW,cAACmV,GAAI,CAACc,MAAI,EAAAhW,SAAE+V,GAAY,IAK7B,SAASE,GAAarX,GAEnC,OACEqB,eAACoV,GAAW,CAAArV,SAAA,CAEhBD,cAACqV,GAAK,CAACxN,GAAG,WAAU5H,SAAC,aAErBD,cAACqV,GAAK,CAACc,MAAO,EAAElW,SAAC,uBAEjBD,cAAA,KAAAC,SAAG,6GACHD,cAAA,KAAAC,SAAG,sMACHD,cAAA,KAAAC,SAAG,oMACHD,cAAA,KAAAC,SAAG,gLACHD,cAAA,KAAAC,SAAG,0EACHD,cAAA,KAAAC,SAAG,mBACHD,cAACqV,GAAK,CAACc,MAAO,EAAGtO,GAAG,eAAc5H,SAAC,iBACnCD,cAAA,KAAAC,SAAG,8FAEHD,cAACoW,KAAK,CAACC,QAASR,GAAiBS,WAAYb,KAE7CvV,eAAA,KAAAD,SAAA,CAAG,6FAA0FD,cAAA,QAAAC,SAAM,QAAU,uCAEzGC,eAAA,MAAII,KAAK,IAAGL,SAAA,CAChBD,cAACuV,GAAa,CAAAtV,SAAC,2GACfC,eAACqV,GAAa,CAAAtV,SAAA,CAAC,2JAA8ID,cAAA,UAAAC,SAAQ,8DAA6D,cAAWD,cAAA,YAE7OA,cAACuV,GAAa,CAAAtV,SAAC,wUACfC,eAACqV,GAAa,CAAAtV,SAAA,CAAC,wCAA2BD,cAAA,SACtCA,cAAA,KAAGuW,KAAK,6BAA6BzW,OAAO,SAAQG,SAAC,8DACzDD,cAACuV,GAAa,CAAAtV,SAAC,kWACXD,cAAA,KAAGuW,KAAK,8BAA8BzW,OAAO,SAAQG,SAAC,4DAC1DD,cAACuV,GAAa,CAAAtV,SAACD,cAAA,KAAAC,SAAG,8KAClBD,cAACuV,GAAa,CAAAtV,SAACD,cAAA,KAAAC,SAAG,uDAClBD,cAACuV,GAAa,CAAAtV,SAACD,cAAA,KAAAC,SAAG,yPAElBD,cAACqV,GAAK,CAACc,MAAO,EAAGtO,GAAG,0CAAyC5H,SAAC,8CAC9DC,eAAA,KAAAD,SAAA,CAAG,8NAAsND,cAAA,QAAMwW,MAAM,WAAW,aAAW,eAAcvW,SAAC,kBAAoB,OAAID,cAAA,QAAMwW,MAAM,WAAW,aAAW,eAAcvW,SAAC,kBAAoB,OACvWD,cAACqV,GAAK,CAACc,MAAO,EAAGtO,GAAG,gBAAe5H,SAAC,kBACpCD,cAAA,KAAAC,SAAG,qMACHD,cAACqV,GAAK,CAACc,MAAO,EAAGtO,GAAG,aAAY5H,SAAC,eAC7BD,cAAA,KAAAC,SAAG,uZACPD,cAACqV,GAAK,CAACc,MAAO,EAAGtO,GAAG,UAAS5H,SAAC,YAC9BC,eAAA,KAAAD,SAAA,CAAG,0BAAuBD,cAAA,KAAGuW,KAAK,0CAAyCtW,SAAC,oBAAc,oBAAiBD,cAAA,KAAGuW,KAAK,2BAA0BtW,SAAC,kBAAkB,KAACD,cAAA,KAAGuW,KAAK,qFAAoFtW,SAAC,uBAAuB,SAAKD,cAAA,KAAGuW,KAAK,6BAA4BtW,SAAC,oBAAmB,qGAKlV,CC/GA,IAAMwW,GAAQlY,IAAOC,IAAGC,QAAAC,YAAA,uGAWT,SAASgY,GAAI7X,GAO1B,OAFA6J,QAAQC,IAAI,cAGV3I,cAAA,OAAK2W,UAAU,MAAK1W,SACpBC,eAAC0W,IAAM,CAAA3W,SAAA,CACPD,cAACmB,EAAM,IACPnB,cAACyW,GAAO,CAAAxW,SACRC,eAAC2W,KAAM,CAAA5W,SAAA,CACPD,cAAC8W,KAAK,CAACC,OAAK,EAACC,KAAK,IAAIC,UAAWf,KAEjClW,cAAC8W,KAAK,CAACE,KAAK,YAAYC,UAAWrY,IAEnCoB,cAAC8W,KAAK,CAACE,KAAK,QAAQjB,OAAQ,SAAClX,GAAK,OAChCmB,cAAC8J,GAAYoN,YAAA,GAAKrY,GAAQ,IAE5BmB,cAAC8W,KAAK,CAACE,KAAK,UAAUjB,OAAQ,SAAClX,GAAK,OAClCmB,cAACmQ,GAAU+G,YAAA,GAAKrY,GAAS,IAE3BmB,cAAC8W,KAAK,CAACE,KAAK,QAAQjB,OAAQ,SAAClX,GAAK,OAChCmB,cAAC+S,GAASmE,YAAA,GAAKrY,GAAS,aAS9B,C,aClDesY,GALKC,aAAgB,CAClChP,MAAQiP,EACRlZ,KAAOmZ,ICEMC,GAJDC,YAAe,CAC3BC,QAASN,K,cCSXO,IAAS3B,OACP/V,cAAC2X,IAAQ,CAACJ,MAAOA,GAAMtX,SACvBD,cAAC0W,GAAG,MAEJ/D,SAASiF,eAAe,Q","file":"static/js/main.14ffc451.chunk.js","sourcesContent":["import {createSlice} from '@reduxjs/toolkit';\n\n//Will be a list of objects\n//{'url', 'rect', 'isSelected', 'index'}\n\nconst bookSlice = createSlice({\n  name: 'book',\n  initialState: {\n    lib: '',\n    url1: '',\n    url2: '',\n    manifest_url: '',\n    usePercent: true,\n    roundPercent: true,\n  },\n  reducers: {\n    setLib(state, action){\n      state.lib = action.payload;\n    },\n    setURL(state, action){\n      state.url1 = action.payload.url1;\n      action.payload.url2 && (state.url2 = action.payload.url2);\n    },\n    setManifestURL(state, action){\n      state.manifest_url = action.payload;\n    },\n    setIIIF(state,action){\n      state.usePercent = action.payload.usePercent;\n      state.roundPercent = action.payload.roundPercent;\n    }\n  }\n});\n\nexport const getLibAndUrls = (state) => {\n  return([state.book.lib, state.book.url1, state.book.url2]);\n}\n\nexport const {setLib, setURL, setManifestURL, setIIIF} = bookSlice.actions\n\nexport default bookSlice.reducer\n","import {React, useState} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {Link} from 'react-router-dom';\nimport {useDispatch} from 'react-redux';\n\nimport { setLib, setURL, setManifestURL, setIIIF } from '../redux/bookSlice.jsx';\n\nconst ManifestSelectorDiv = styled.div`\ndisplay:flex;\n`\n\nconst iiif_settings = (lib) => {\n  let usePercent = true;\n  let roundPercent = true;\n  if (lib == 'HRC'){\n    usePercent = false;\n  }\n  return(\n    {\n      usePercent: usePercent,\n      roundPercent: roundPercent\n    }\n  );\n}\n\nexport default function ManifestSelector(props){\n\n  const dispatch = useDispatch();\n\n  const [libPick, setLibPick] = useState(\"\");\n  const [url1, setUrl1] = useState(\"\");\n  const [url2, setUrl2] = useState(\"\");\n\n  const handleChange = (event) => {\n    const target = event.target;\n    const name = target.name;\n    const value = target.value;\n\n    if (name === 'libPick'){setLibPick(value)}\n    else if (name === 'url1'){setUrl1(value)}\n    else if (name === 'url2'){setUrl2(value)}\n\n  }\n\n  const dispatchManifest = () => {\n    dispatch(setURL({url1: url1, url2: url2}));\n    dispatch(setLib(libPick));\n    dispatch(setIIIF(iiif_settings(libPick)));\n  }\n\n  return(\n    <ManifestSelectorDiv>\n    <form style={{padding: \"20px\"}}>\n    <label>\n    Pick your library: \n    <select name=\"libPick\" value={libPick} \n    onChange={handleChange}>\n    <option value=\"\"></option>\n    <option value=\"HRC\">HRC</option>\n    <option value=\"BL\">BL</option>\n    <option value=\"Harvard\">Harvard</option>\n    <option value=\"Cambridge\">Cambridge</option>\n    <option value=\"IA\">Internet Archive</option>\n    <option value=\"Folger\">Folger</option>\n    <option value=\"Internal\">Internal</option>\n    <option value=\"Experimental\">Experimental</option>\n    </select>\n    </label><br/>\n\n    {libPick !== '' && \n      <div>\n      <br/>\n      <p>Specify Manifest:</p><br/>\n      {libPick === 'HRC' &&\n        <p>https://norman.hrc.utexas.edu/notDM/objectManifest/[Piece 1]/[Piece 2]/<br/><br/></p>\n      }\n      {libPick === 'BL' &&\n          <p>https://api.bl.uk/metadata/iiif/ark:/[Piece 1]/[Piece 2]/manifest.json</p>\n      }\n      {libPick === 'Harvard' &&\n          <p>https://iiif.lib.harvard.edu/manifests/[Piece 1]</p>\n      }\n      {libPick === 'Cambridge' &&\n          <p>https://cudl.lib.cam.ac.uk/iiif/[Piece 1]</p>\n      }\n      {libPick === 'IA' &&\n          <p>https://iiif.archive.org/iiif/[Piece 1]/manifest.json</p>\n      }\n      {libPick === 'Folger' &&\n          <p>https://luna.folger.edu/luna/servlet/iiif/m/[Piece 1]/manifest</p>\n      }\n      {libPick === 'Internal' &&\n          <p>Internal use only</p>\n      }\n      {libPick === 'Experimental' &&\n          <p>This uses an experimental manifest parser.  You probably want one of the other choices, unless I have asked you to test this.</p>\n      }\n      <br/>\n      <label>\n      URL Piece 1:\n      <input name=\"url1\" type=\"text\" \n      value={url1}\n      onChange={handleChange} />\n      </label>&nbsp;&nbsp;&nbsp;\n      {libPick !== 'Harvard' && libPick !== 'Cambridge' && libPick !== 'IA' && libPick !== 'Folger' && libPick !== 'Internal' && libPick !== 'Experimental' &&\n          <label>\n          URL Piece 2:\n          <input name=\"url2\" type=\"text\" \n        value={url2}\n        onChange={handleChange} />\n          </label>\n      }\n      <br/><br/>\n      <Link to={`/rect/`}><button onClick={dispatchManifest}>Use this manifest</button></Link>\n\n      </div>\n    }\n    </form>\n    </ManifestSelectorDiv>\n  );\n}\n\n","import React from 'react';\nimport styled, {css} from 'styled-components';\n\nimport {  NavLink} from 'react-router-dom';\n\nconst TopBarDiv = styled.div`\n/*display: fixed;*/\ndisplay:relative;\ntop: 0;\nleft: 0;\nright: 0;\npadding-bottom: 15px;\nheight: 10em;\n/*background: #eeeeee;*/\nbackground-image: url('../../blankpaper.jpg');\n`\n\nconst TopTitle=styled.h1`\nfont-size: xxx-large;\ncolor: #333333;\nwidth:100%;\ndisplay: inline-block;\nmargin: 10px;\n`\nconst NavBar=styled.div`\ndisplay: flex;\nflex-direction: row;\nposition:absolute;\nwidth: 100%;\ntop: 0;\nleft: 0;\nright: 0;\nz-index: 2;\nflex-wrap: wrap;\n`\n\nconst NavBarItem=styled(NavLink)`\nflex: 1;\nbackground: white;\ntext-decoration: none;\ncolor:black;\ndisplay: inline-block;\nborder: 2px solid green;\nborder-radius: 3px;\nmargin: 5px;\npadding: 5px;\ntext-align: center;\n`\nexport default function TopBar(props) {\n\n    //need to build bookstr for the paths here\n    //also get rectangle if we have it\n    //also do we pass more things? maybe just redux.\n    return(\n    <TopBarDiv>\n<NavBar>\n      <TopTitle>Coloring Book</TopTitle>\n      <NavBarItem to=\"/\">Overview</NavBarItem>\n      <NavBarItem to=\"/manifest\">Input Manifest</NavBarItem>\n      <NavBarItem to=\"/rect\">Select Rectangle</NavBarItem>\n      <NavBarItem to=\"/scraps\">Edit Rectangles</NavBarItem>\n      <NavBarItem to=\"/plot\">View Plot</NavBarItem>\n      {/*<NavLink>Extract Colors</NavLink>*/}\n      </NavBar>\n      </TopBarDiv>\n    );\n}\n\n","\n\n\nimport React from 'react';\nimport {useRef, useState, useEffect, useMemo} from 'react';\nimport styled from 'styled-components';\nimport {Link} from 'react-router-dom';\nimport {useSelector} from 'react-redux';\n\nconst ClearDiv = styled.div`\nleft:0;\n&:before,\n&:after {\n   content: '\\\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n`\n\nexport default function RectSelect(props) {\n\n  const canvasRef = useRef();              \n  const canvasRef2 = useRef();              \n  const imageRef = useRef();\n  const [imgWH, setImgWH] = useState({width: '100%', height: '100%'});\n  const [maxWH, setMaxWH] = useState({width: null, height: null});\n  const [cvs_ready, setCvsReady] = useState(false);\n  const usePercent = useSelector(state => state.book.usePercent);\n  const roundPercent = useSelector(state => state.book.roundPercent);\n    \n  const imageRefs = useMemo(\n    () => props.img_urls.map(()=> React.createRef()),\n    [props.img_urls.join(',')]\n  );\n\n  const [numLoaded, setNumLoaded] = useState(0);\n  const rectColor = '#FF0000';\n  const lineWidth = 5;\n\n  let isDown = false;\n  let startX = null;\n  let startY = null;\n  let endX = null;\n  let endY = null;\n\n  const loadListen = () => {\n    if (numLoaded + 1 >= props.img_urls.length){\n      renderComposite();\n    }\n    setNumLoaded(num => num+1);\n  }\n\n  //COME BACK TO THIS BLOCK\n  useEffect( () => {\n    const ctx = canvasRef.current.getContext('2d');\n    ctx.fillText(\"Please wait, loading...\", 100, 10);\n  }, []);\n    \n\n  const renderComposite = () => {\n    const max_w = Math.max(...imageRefs.map((ref) => ref.current.width));\n    const max_h = Math.max(...imageRefs.map((ref) => ref.current.height));\n    const cvs = canvasRef.current;\n    const cvs2 = canvasRef2.current;\n    const ctx = cvs.getContext('2d');\n    const ctx2 = cvs2.getContext('2d');\n    cvs.width = max_w;\n    cvs.height = max_h;\n    cvs2.width = max_w;\n    cvs2.height = max_h;\n    ctx.fillStyle = 'white';\n    ctx.fillRect(0,0,max_w,max_h);\n    let newData = ctx.getImageData(0,0,max_w,max_h);\n    //this.ctx.createImageData(max_w, max_h);\n    for (let i=0; i<imageRefs.length; i++){\n      ctx.drawImage(imageRefs[i].current, 0,0);\n      let imgdat = ctx.getImageData(0,0,max_w, max_h);\n\n      //looping explicitly because we'll do LUV later, maybe\n      for (let j = 0; j < newData.data.length; j += 4) {\n        newData.data[j+0] = Math.min(newData.data[j+0], imgdat.data[j+0]);\n        newData.data[j+1] = Math.min(newData.data[j+0], imgdat.data[j+0]);\n        newData.data[j+2] = Math.min(newData.data[j+0], imgdat.data[j+0]);\n        newData.data[j+3] = 255;\n      }\n    };\n    ctx.putImageData(newData, 0,0);\n    setMaxWH({width:max_w, height: max_h});\n    setCvsReady(true);\n  }\n\n  const draw = () => {\n    const c = 1;\n    const cvs2 = canvasRef2.current;\n    const ctx2 = cvs2.getContext('2d');\n\n    ctx2.clearRect(0,0,maxWH.width,maxWH.height);\n    ctx2.beginPath();\n    ctx2.lineWidth=lineWidth;\n    ctx2.strokeStyle=rectColor;\n    ctx2.rect(c*startX, c*startY, c*endX-c*startX, c*endY-c*startY);\n    ctx2.stroke();\n  }\n\n  const handleMouseDown = e => {\n    if (!cvs_ready){return};\n    const cvs2 = canvasRef2.current;\n    [startX, startY] = getMousePosition(cvs2, e);\n    isDown = true;\n    getMousePosition(cvs2, e);\n  }\n  const handleMouseMove = e => {\n    if (!cvs_ready){return};\n    if (!isDown) return;\n    const cvs2 = canvasRef2.current;\n    [endX, endY] = getMousePosition(cvs2, e);\n   // const dx = mouseX - startX;\n   // const dy = mouseY - startY;\n   // startX = mouseX;\n   // startY = mouseY;\n   // dragTarget.x += dx;\n   // dragTarget.y += dy;\n    draw();\n  }\n\n  const handleMouseUp = e => {\n    if (!cvs_ready){return};\n    if (!isDown){return};\n    isDown = false;\n    const cvs2 = canvasRef2.current;\n    [endX, endY] = getMousePosition(cvs2, e);\n    draw();\n    const left = Math.round(Math.min(startX, endX));\n    const right = Math.round(Math.max(startX, endX));\n    const top = Math.round(Math.min(startY, endY));\n    const bottom = Math.round(Math.max(startY, endY));\n    const rect = {left : left, right: right, bottom: bottom, top: top};\n    // left top right bottom\n    if (usePercent){\n      rect.left = rect.left/maxWH.width*100;\n      rect.right = rect.right/maxWH.width*100;\n      rect.top = rect.top/maxWH.height*100;\n      rect.bottom = rect.bottom/maxWH.height*100;\n      if (roundPercent){\n        rect.left = Math.round(rect.left);\n        rect.right = Math.round(rect.right);\n        rect.top = Math.round(rect.top);\n        rect.bottom = Math.round(rect.bottom);\n      }\n    }\n    props.recordRect(rect);\n  }\n  const handleMouseOut = e => {\n    handleMouseUp(e);\n  }\n\n  const getMousePosition = (canvas, event) => {\n    let rect = canvas.getBoundingClientRect(); \n    const cvs2 = canvasRef2.current;\n    let x= (event.clientX-rect.left)/(rect.right - rect.left)*cvs2.width\n    let y=(event.clientY-rect.top)/(rect.bottom - rect.top)*cvs2.height\n    return [x, y]\n  }\n\n\n    return (\n      <ClearDiv>\n      <canvas ref={canvasRef}\n      style={{ position:\"absolute\", width: \"100%\",\n          display: \"block\",\n          /*margin: \"5% auto\", left: 0, right:0,*/\n          \"zIndex\": 1\n      }}\n      /> \n      <canvas width={1000} height={500} ref={canvasRef2}\n      style={{position:\"absolute\", width: \"100%\",\n          display: \"inline-block\",\n          /*margin: \"5% auto\", left: 0, right:0,*/\n          \"zIndex\": 2\n      }}\n      onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseOut={handleMouseOut}\n      /> \n      {props.img_urls.map((url,i) =>\n        <img crossOrigin=\"anonymous\"\n        ref={imageRefs[i]}\n        src={url}\n        key={url}\n        onLoad={loadListen}\n        style={{visibility: \"hidden\", position: \"fixed\"}}\n      />)}\n</ClearDiv>\n    );\n}\n\n","import {createSlice} from '@reduxjs/toolkit';\n\n//Will be a list of objects\n//{'url', 'rect', 'isSelected', 'index'}\n\nconst pagesSlice = createSlice({\n  name: 'pages',\n  initialState: [],\n  reducers: {\n    setPagesFromURLs(state, action){\n      //if (state.length > 0){\n      //  return(state);\n      //}\n      return(action.payload.map((url, i) => {\n        return({ url: url, rect: {}, isSelected: true, index: i, color: {} });\n      })\n      )\n    },\n\n    setDefaultRect(state, action){\n      state.forEach((page) => page.rect = action.payload);\n    },\n    setRect(state, action){\n      const {id, new_rect} = action.payload;\n      const page = state.find(page => page.index === id);\n      page.rect = new_rect;\n    },\n    setPageColor(state, action){\n      const {id, color} = action. payload;\n      const page = state.find(page => page.index === id);\n      page.color = color;\n    },\n    toggleSelected(state, action){\n      const page = state.find(page => page.index === action.payload);\n      page.isSelected = !page.isSelected;\n    }\n  }\n});\n\n  //{image_urls, colors} = useSelector(getSelectedPlotInfo);\n\nexport const getSelectedPlotInfo = state => {\n  return(state.pages.filter(page => page.isSelected));\n}\n\n\nexport const { setPagesFromURLs, setDefaultRect, setRect, toggleSelected, setPageColor} = pagesSlice.actions\n\nexport default pagesSlice.reducer\n","import {React, useState, useEffect} from 'react';\nimport styled, { css } from 'styled-components';\nimport RectSelect from './RectSelect.jsx';\nimport {Link} from 'react-router-dom';\nimport {useDispatch, useSelector} from 'react-redux';\n\nimport {setPagesFromURLs,setDefaultRect } from '../redux/pagesSlice.jsx';\nimport {getLibAndUrls} from '../redux/bookSlice.jsx';\n\nconst InstructionDiv = styled.div`\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: justify;\n  margin: 20px auto;\n  padding: 20px;\n`\n\nconst RectLink=styled(Link)`\nflex: 1;\nbackground: white;\ncolor:black;\ndisplay: inline-block;\nborder: 2px solid green;\nborder-radius: 3px;\nmargin: 5px;\npadding: 5px;\ntext-align: center;\n`\n\nconst ClearDiv = styled.div`\n&:before,\n&:after {\n   content: '\\\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n`\n\nconst get_manifest_url = (lib, url1, url2) => {\n  if (lib === 'HRC'){\n    return(\"https://norman.hrc.utexas.edu/notDM/objectManifest/\"+url1+'/'+url2+'/');\n  } \n  if (lib === 'BL'){\n    return(\"https://api.bl.uk/metadata/iiif/ark:/\"+url1+\"/\"+url2+\"/manifest.json\");\n  } \n  if (lib === 'Harvard'){\n    return(\"https://iiif.lib.harvard.edu/manifests/\"+url1);\n  } \n  if (lib === 'Cambridge'){\n    return(\"https://cudl.lib.cam.ac.uk/iiif/\"+url1);\n  } \n  if (lib === 'IA'){\n    return(\"https://iiif.archive.org/iiif/\"+url1+\"/manifest.json\");\n  } \n  if (lib === 'Folger'){\n    return(\"https://luna.folger.edu/luna/servlet/iiif/m/\"+url1+\"/manifest\");\n  } \n  if (lib == 'Internal'){\n    return(url1)\n  }\n  if (lib == 'Experimental'){\n    return(url1)\n  }\n  console.log(\"Oh sad, not the library!\");\n  //Deal with the unknown library error one day\n}\n\nconst parseInternalResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  return(url_array);\n}\nconst parseHRCResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['@id']);\n  return(url_array);\n}\nconst parseBLResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  return(url_array);\n}\nconst parseHarvardResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  return(url_array);\n}\nconst parseCambridgeResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  const url_array2 = url_array.map((item) => item+'/full/full/0/default.jpg');\n\n  return(url_array2);\n}\nconst parseIAResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  return(url_array);\n}\nconst parseFolgerResponse = (resp_obj) => {\n  const url_array = resp_obj['sequences'][0]['canvases'].map((item) => item['images'][0]['resource']['@id']);\n  return(url_array);\n}\n\n// this function is intended to eventually replace all the parsing code above\nconst extractImageUrls = (resp_obj) => {\n  let url_array = [];\n  if (resp_obj['sequences'] && resp_obj['sequences'][0]['canvases']) {\n    const canvases = resp_obj['sequences'][0]['canvases'];\n    for (let i = 0; i < canvases.length; i++) {\n      const images = canvases[i]['images'];\n      if (images && images.length > 0) {\n        const resource = images[0]['resource'];\n        if (resource) {\n          let url = resource['@id'] || images[0]['@id'];\n          if (url) {\n            const cambridgeDomain = 'cam.ac.uk';\n            const hasCambridgeDomain = url.indexOf(cambridgeDomain) !== -1;\n            const cmuDomain = 'library.cmu.edu';\n            const hasCmuDomain = url.indexOf(cmuDomain) !== -1;\n            //I was wrong about the three char extension, actually should still\n            //append\n            //const hasThreeCharExtension = url.match(/\\.\\w{3}$/) !== null;\n            //if (hasCambridgeDomain && !hasThreeCharExtension) {\n            if (hasCambridgeDomain) {\n              url += '/full/full/0/default.jpg';\n            } else if (hasCmuDomain){\n              url = resource['service']['@id'];\n              url += '/full/full/0/default.jpg';\n            }\n            url_array.push(url);\n          }\n        }\n      }\n    }\n  }\n  return url_array;\n}\n\nexport default function MarginMarker(props) {\n  const [loaded, setLoaded] = useState(false);\n  const [rect, setRect] = useState({});\n\n  const [lib, url1, url2] = useSelector(getLibAndUrls);\n  const img_list = useSelector(state => state.pages.map(page => page.url));\n  const usePercent = useSelector(state => state.book.usePercent);\n\n\n\n  const samp_skip = 4;//to skip at start and end\n  const samp_num = 8;//number of pages to superimpose\n  \n  const dispatch = useDispatch();\n\n  const recordRect = (rect) => {\n    dispatch(setDefaultRect(rect));\n    setRect(rect);\n  }\n\n\n\n  useEffect(()=>{\n    const fetchManifest = async (lib, url1, url2) => {\n      const manifest_url = get_manifest_url(lib, url1, url2);\n      console.log('Requesting: ' + manifest_url);\n      const response = await fetch(manifest_url);\n      if (response.status >= 400){\n        console.log(\"bad response: \" + response.status)\n        throw new Error (\"Bad response to manifest request\");\n      }\n\n      const resp_obj = await response.json();\n      let items = [];\n      if (lib === 'HRC'){\n        items = parseHRCResponse(resp_obj);\n      } else if (lib == 'BL'){\n        items = parseBLResponse(resp_obj);\n      } else if (lib == 'Harvard'){\n        items = parseHarvardResponse(resp_obj);\n      } else if (lib == 'Internal'){\n        items = parseInternalResponse(resp_obj);\n      } else if (lib == 'Experimental'){\n        items = extractImageUrls(resp_obj);\n      } else if (lib == 'Cambridge'){\n        items = parseCambridgeResponse(resp_obj);\n      } else if (lib == 'IA'){\n        items = parseIAResponse(resp_obj);\n      } else if (lib == 'Folger'){\n        items = parseFolgerResponse(resp_obj);\n      }else {\n        //Handle this eventually\n      }\n      //write to the store here too\n      //setPagesFromURLs\n      dispatch(setPagesFromURLs(items));\n\n      setLoaded(true);\n    }\n    fetchManifest(lib, url1, url2)\n  }, [lib, url1, url2]);\n\n    // left top right bottom\n    const top = rect.top;\n    const bottom = rect.bottom;\n    const left = rect.left;\n    const right = rect.right;\n\n    //const querystr = '?'+[\"l=\"+left,\"t=\"+top,\"r=\"+right,\"b=\"+bottom].join('&');\n    //console.log('query from marginmarker: ', querystr);\n    return(\n      <div>\n      {!loaded && \n        <InstructionDiv>\n        Please wait, requesting manifest.  This can take up to a minute for some library servers.\n        </InstructionDiv>\n      }\n      {loaded && \n        <ClearDiv>\n        <InstructionDiv>\n        A sample of pages are superimposed below.  Select a rectangle from the top or bottom margin of the page that consistently excludes text and other marks.  Side margins do not work as well because we ignore recto/verso distinctions.\n        <br/><br/>\n        <RectLink \n        to={{\n          pathname: `/scraps`,\n                    }} >\n        Use this rectangle\n        </RectLink>\n        </InstructionDiv>\n        <RectSelect recordRect={recordRect}\n        roundPercent={lib!== 'HRC'}\n        img_urls={img_list.filter((x,i) => \n          (\n          ((i - samp_skip) % Math.floor((img_list.length - 2*samp_skip)/(samp_num-1))) === 0\n        )\n        )}\n        />\n        </ClearDiv>\n      }\n      </div>\n\n\n    );\n\n}\n\n\n","import {React, useState} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {useSelector, useDispatch} from 'react-redux';\nimport {toggleSelected} from '../redux/pagesSlice.jsx';\n\n\nconst PaperImgDiv = styled.div`\n  position: relative;\n  width: 400px;\n  margin-left: 10px;\n  margin-right: 10px;\n  margin-top: 5px;\n  margin-bottom: 5px;\n  ${({cancelled}) => !cancelled && `\n  color='gray';\n  background='gray';\n  z-index: 10;\n  `}\n\n`\nconst PaperImg = styled.img`\n  width: 100%;\n  height: auto;\n  z-index: 1;\n  ${({cancelled}) => cancelled && `\n  opacity: 0.1;\n  border-color: black;\n  border-width: 1px;\n  border-style: dotted;\n  padding: 0;\n  `}\n${({cancelled}) => !cancelled && `\n  padding: 1px;\n  `}\n`\nconst PaperButtonImageR = styled.img`\n  position: absolute;\n  right: 2px;\n  top: 2px;\n  z-index: 2;\n  ${({active}) => !active && `\n  visibility: hidden;\n  `}\n`\nconst PaperButtonImageL = styled.img`\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  z-index: 2;\n${({active}) => !active && `\n  visibility: hidden;\n  `}\n`\n\nexport default function PaperScrap(props){\n\n  const dispatch = useDispatch();\n\n  const [hovered, setHovered] = useState(false);\n  \n  \n  //takes event from click.\n  const toggleScrap = (e) => {\n    dispatch(toggleSelected(props.index));\n  }\n\n  const usePercent = useSelector(state => state.book.usePercent);\n  const cancelled = useSelector(state => !(state.pages.find(page => page.index == props.index).isSelected));\n  const rect = useSelector(state => state.pages.find(page => page.index == props.index).rect);\n  \n  const url = useSelector(state => state.pages.find(page => page.index == props.index).url);\n  const lib = useSelector(state => state.book.lib);\n\n  const rect_str = (usePercent ? 'pct:' : '') + [rect.left, rect.top, rect.right-rect.left, rect.bottom-rect.top].join(',');\n  let urlbase = url.split('full')[0];\n  urlbase = urlbase + (urlbase[urlbase.length-1]==='/' ? '' : '/');\n  const src_url = urlbase + rect_str + \"/full/0/default.jpg\";\n\n\n  const RButtonSrc = cancelled ? '/add_icon_small.png' : '/delete_icon_small.png';\n\n    return(\n      <PaperImgDiv\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n      cancelled={cancelled}\n      >\n      <PaperImg key={props.index} idx={props.index} ref={props.imageRef}\n      crossOrigin=\"anonymous\"\n      src={src_url}\n      cancelled={cancelled}\n      onLoad={props.process}\n      />\n      <PaperButtonImageL active={hovered} onClick={props.editRect} width=\"25px\" height=\"25px\" src='/edit_icon_small.png' />\n      <PaperButtonImageR active={hovered} onClick={toggleScrap} width=\"25px\" height=\"25px\" src={RButtonSrc} />\n      </PaperImgDiv>)\n}\n\n\n","\n//Code from https://github.com/vinaypillai/ac-colors/blob/master/dist/ac-colors.js\n\nexport function rgbToXyz(rgb) {\n  // Normalise rgb to \\[0,1\\]\n  const cR = rgb[0] / 255;\n  const cG = rgb[1] / 255;\n  const cB = rgb[2] / 255;\n  // sRGB is a gamma corrected format (a method of adjusting color\n  // to match non linear human perception of light) gamma correction\n  // must undone. The inverse function is linear below a corrected\n  // value of 0.04045 since gamma correction is linear at 0.0031308\n  const invCompand = (c) => (c <= 0.04045) ?\n    c / 12.92 :\n    Math.pow((c + 0.055) / 1.055, 2.4);\n  const invR = invCompand(cR);\n  const invG = invCompand(cG);\n  const invB = invCompand(cB);\n  // Linear rgb is then undergoes a forward transformation to xyz\n  const x = 0.4124 * invR + 0.3576 * invG + 0.1805 * invB;\n  const y = 0.2126 * invR + 0.7152 * invG + 0.0722 * invB;\n  const z = 0.0193 * invR + 0.1192 * invG + 0.9505 * invB;\n  // xyz scaled to \\[0,100\\]\n  // Add zero to prevent signed zeros (force 0 rather than -0)\n  return [x * 100 + 0, y * 100 + 0, z * 100 + 0];\n}\n\nexport function xyzToLuv(xyz) {\n  const x = xyz[0];\n  const y = xyz[1];\n  const z = xyz[2];\n  const d65 = [95.05, 100, 108.9];\n  const eps = 216 / 24389;\n  const kap = 24389 / 27;\n  const Xn = d65[0];\n  const Yn = d65[1];\n  const Zn = d65[2];\n  const vR = 9 * Yn / (Xn + 15 * Yn + 3 * Zn);\n  const uR = 4 * Xn / (Xn + 15 * Yn + 3 * Zn);\n  // If XYZ = [0,0,0], avoid division by zero and return conversion\n  if (x === 0 && y === 0 && z === 0) {\n    return [0, 0, 0];\n  }\n  const v1 = 9 * y / (x + 15 * y + 3 * z);\n  const u1 = 4 * x / (x + 15 * y + 3 * z);\n  const yR = y / Yn;\n  const cbrt = (Math.cbrt != null) ?\n    Math.cbrt :\n    (val) => Math.pow(val, 1 / 3);\n  const L = (yR > eps) ? 116 * cbrt(yR, 1 / 3) - 16 : kap * yR;\n  const u = 13 * L * (u1 - uR);\n  const v = 13 * L * (v1 - vR);\n  // Add zero to prevent signed zeros (force 0 rather than -0)\n  return [L + 0, u + 0, v + 0];\n}\n\nexport default function rgbToLuv(rgb){\n  return xyzToLuv(rgbToXyz(rgb));\n}\n\n","export function median(numbers) {\n    const sorted = numbers.slice().sort((a, b) => a - b);\n    const middle = Math.floor(sorted.length / 2);\n\n    if (sorted.length % 2 === 0) {\n        return (sorted[middle - 1] + sorted[middle]) / 2;\n    }\n\n    return sorted[middle];\n}\n\nexport function mean(numbers) {\n    return(numbers.reduce((acc, cur) => acc + cur)/numbers.length)\n}\n","import React from 'react';\nimport {useRef, useState, useEffect, useMemo} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport RectSelect from './RectSelect.jsx';\nimport ReactModal from 'react-modal';\nimport {Link, useLocation} from 'react-router-dom';\nimport {useDispatch, useSelector} from 'react-redux';\n\nimport PaperScrap from './PaperScrap.jsx';\nimport {toggleSelected, setRect, setPageColor} from '../redux/pagesSlice.jsx';\nimport rgbToLuv from '../rgbToLuv.js';\nimport {median, mean} from '../summaries.js';\n\nconst ImgBoxDiv = styled.div`\n  display: flex;\n  justify-content: center;\n  flex-direction: row;\n  background: #eeeeee;\n  flex-wrap: wrap;\n  padding-bottom: 50px;\n  padding-top: 25px;\n`\nconst customStyles = {\n  overlay: {zIndex: 1000,\n  backgroundColor: \"gray\"}\n};\n\nconst InstructionDiv = styled.div`\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: justify;\n  margin: 20px auto;\n  padding: 20px;\n`\n\nexport default function ScrapTable(props) {\n\n  const dispatch = useDispatch();\n\n  const location = useLocation();\n\n  const canvasRef = useRef();\n\n  const [edit_idx_and_modal, setEditIdxAndModal] = useState({modal: false, index: null});\n  const [n_loaded, setNLoaded] = useState(0);\n  \n  const lib = useSelector(state => state.book.lib);\n  const img_urls = useSelector(state => state.pages.map(page => page.url));\n\n  //const rectFromSearch = (search) => {\n  //  const query = new URLSearchParams(location.search);\n  //  const rect = {left: query.get('l'),\n  //    right: query.get('r'),\n  //    top: query.get('t'),\n  //    bottom: query.get('b'),\n  //  }\n  //  return(rect);\n  //}\n\n  //const [base_rect, setBaseRect] = useState(rectFromSearch(location.search));\n  //useEffect(() => {\n  //  setBaseRect(rectFromSearch(location.search));\n  //}, [location.search]);\n\n  //May have to fix this for that library that uses underscores in the IDs.\n  //const [url12, setUrl12] = useState(props.match.params.book.split('_'));\n  //useEffect(() => {\n  //  setUrl12(props.match.params.book.split('_'));\n  //}, [props.match.params.book]);\n \n  //const [lib, setLib] = useState(props.match.params.lib);\n  //useEffect(() => {\n  //  setLib(props.match.params.lib);\n  //}, [props.match.params.lib]);\n\n\n\n  const imageRefs = useMemo(\n    () => img_urls.map(()=> React.createRef()),\n    [img_urls.length, img_urls]\n  );\n\n  const replaceRect = (i, rect) => {\n    dispatch(setRect({id: i, new_rect: rect}));\n  }\n\n  const getImageData = (imageRef) => {\n    const cvs = canvasRef.current\n    const ctx = cvs.getContext('2d');\n    const image_height = imageRef.current.naturalHeight; //can drop natural for old one\n    const image_width = imageRef.current.naturalWidth;\n    cvs.width = image_width;\n    cvs.height = image_height;\n    ctx.drawImage(imageRef.current, 0,0);\n    const imgData = ctx.getImageData(0,0,image_width, image_height);\n    return imgData.data;//just the flat RGBA array\n\n  }\n\n  const summarizeImage = (data) => {\n    let Rarray = []; let Garray = []; let Barray = [];\n    let Larray = []; let Uarray = []; let Varray = [];\n    for (let i = 0; i < data.length; i += 4) {\n      let rgb = data.slice(i, i+3);\n      Rarray.push(rgb[0]);     // red\n      Garray.push(rgb[1]); // green\n      Barray.push(rgb[2]); // blue\n      //Now we'll switch to luv\n      let luv = rgbToLuv(rgb);\n      Larray.push(luv[0]); \n      Uarray.push(luv[1]); \n      Varray.push(luv[2]); \n    }\n    return({\n      med_rgb: [median(Rarray), median(Garray), median(Barray)],\n      med_luv: [median(Larray), median(Uarray), median(Varray)],\n      mean_rgb: [mean(Rarray), mean(Garray), mean(Barray)],\n      mean_luv: [mean(Larray), mean(Uarray), mean(Varray)]\n    });\n  }\n\n  //mean version\n  //const summarizeImage = (data) => {\n  //  let Rsum = 0; let Gsum = 0; let Bsum = 0;\n  //  for (let i = 0; i < data.length; i += 4) {\n  //    //Now we'll switch to luv\n  //    let luv = rgbToLuv(data.slice(i, i+3));\n  //    Rsum  += luv[0];     // red\n  //    Gsum += luv[1]; // green\n  //    Bsum += luv[2]; // blue\n  //    //Rsum  += data[i];     // red\n  //    //Gsum += data[i + 1]; // green\n  //    //Bsum += data[i + 2]; // blue\n  //  }\n  //  return [Rsum*4/data.length, Gsum*4/data.length, Bsum*4/data.length];\n  //}\n\n\n\n  const processImage = (i) => {\n    const data = getImageData(imageRefs[i]);\n    const image_color = summarizeImage(data);\n    dispatch(setPageColor({id: i, color: image_color}));\n    setNLoaded( n => n + 1 );//increment count of loaded images to disable button.\n  }\n \n  const handleCloseModal=  () => {\n    setEditIdxAndModal({modal: false, index: null});\n  }\n\n  const editRect = (i) => {\n      setEditIdxAndModal({modal: true, index: i});\n    }\n\n  // left top right bottom\n  return(\n    <div>\n    <div style={{textAlign: \"center\"}}>\n    <InstructionDiv>\n    Remove any unwanted pages, and correct any poorly-cropped pages.  Try to select sections of paper without ink or stains, while keeping selections in approximately the same region of the page.<br/><br/>\n\n    When you are satisfied, proceed here:<br/><br/>\n    {n_loaded >= img_urls.length &&\n    <Link to={{\n      pathname: `/plot/`,\n    }}\n    ><button>Extract Color Information</button></Link>}\n    {n_loaded < img_urls.length &&\n        <p>Please wait until all pages have loaded below.</p>}\n\n    </InstructionDiv>\n\n    <div>\n         <ImgBoxDiv>\n      {imageRefs.map((ref, i) => {\n        return(<PaperScrap key={i} index={i} imageRef={ref}\n        process = {() => processImage(i)}\n        editRect = {() => editRect(i)}\n        />)})}\n\n        </ImgBoxDiv>\n \n\n      </div>\n\n    <canvas ref={canvasRef} width=\"100px\" height=\"100px\" style={{visibility: \"hidden\"}}/>\n    </div>\n    <ReactModal isOpen={edit_idx_and_modal.modal}\n    style={customStyles}\n    onRequestClose={handleCloseModal}\n    >\n    <RectSelect \n    usePercent={props.usePercent && lib !== 'HRC'}\n    roundPercent={lib !== 'HRC'}\n    img_urls={[img_urls[edit_idx_and_modal.index]]}\n    recordRect={(rect) => replaceRect(edit_idx_and_modal.index, rect)}\n    />\n\n    </ReactModal>\n    </div>\n  );\n}\n","import { React, useState, useEffect, useRef } from \"react\";\n\nimport styled, { css } from \"styled-components\";\n\nimport Chart from \"react-google-charts\";\n\nimport { useLocation } from \"react-router-dom\";\n\nimport { useDispatch, useSelector } from \"react-redux\";\n\nimport { getSelectedPlotInfo } from \"../redux/pagesSlice.jsx\";\n\nconst PeekImg = styled.img`\n  ${({ hiding }) =>\n    hiding &&\n    `\n  visibility: hidden;\n  `}\n`;\n\nconst InstructionDiv = styled.div`\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: center;\n  margin: 20px auto;\n  padding: 20px;\n`;\nconst RadioDiv = styled.div`\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  text-align: center;\n  margin: 10px;\n  padding: 10px;\n`;\nconst download_data = (pages) => {\n  let csv =\n    \"index,rect_left,rect_right,rect_bottom,rect_top,med_L,med_U,med_V,med_R,med_G,med_B,mean_L,mean_U,mean_V,mean_R,mean_G,mean_B,URL\\n\";\n  csv =\n    csv +\n    pages\n      .map(\n        (x) =>\n          [\n            x.index,\n            x.rect.left,\n            x.rect.right,\n            x.rect.bottom,\n            x.rect.top,\n            ...x.color.med_luv,\n            ...x.color.med_rgb,\n            ...x.color.mean_luv,\n            ...x.color.mean_rgb,\n            x.url,\n          ].join(\",\") + \"\\n\"\n      )\n      .reduce((acc, cur) => acc + cur);\n  const filename = \"export.csv\";\n  csv = \"data:text/csv;charset=utf-8,\" + csv;\n  const csv_enc = encodeURI(csv);\n  const link = document.createElement(\"a\");\n  link.setAttribute(\"href\", csv_enc);\n  link.setAttribute(\"download\", filename);\n  link.click();\n};\n\nexport default function PaperPlot(props) {\n  const imageRef = useRef();\n  const rectCanvasRef = useRef(); //for drawing rectangle\n  const usePercent = useSelector((state) => state.book.usePercent);\n\n  //const location = useLocation();\n\n  const [data_color, setDataColor] = useState(\"luv\");\n  const [data_summary, setDataSummary] = useState(\"med\");\n  const [plot_width, setPlotwidth] = useState(\"split\");\n\n  const lib = useSelector((state) => state.book.lib);\n\n  const selected_pages = useSelector(getSelectedPlotInfo);\n\n  const handleColorChange = (e) => {\n    setDataColor(e.target.value);\n  };\n  const handleSummaryChange = (e) => {\n    setDataSummary(e.target.value);\n  };\n  const handlePlotwidthChange = (e) => {\n    setPlotwidth(e.target.value);\n  };\n\n  const selectImage = (i) => {\n    const lineWidth = 5;\n    const rectColor = \"#00ff00\";\n    const fullurl = selected_pages[i].url;\n    const smallurl = fullurl.replace(\"full/full\", \"full/500,\");\n    imageRef.current.src = smallurl;\n    const pagerect = selected_pages[i].rect;\n    //Set up canvas, draw rectangle.\n    const cvs = rectCanvasRef.current;\n    const ctx = cvs.getContext(\"2d\");\n    const image_height = imageRef.current.naturalHeight; //can drop natural for old one\n    const image_width = imageRef.current.naturalWidth;\n    cvs.width = image_width;\n    cvs.height = image_height;\n    if (usePercent) {\n      pagerect.top = Math.round((pagerect.top * image_height) / 100);\n      pagerect.bottom = Math.round((pagerect.bottom * image_height) / 100);\n      pagerect.left = Math.round((pagerect.left * image_width) / 100);\n      pagerect.right = Math.round((pagerect.right * image_width) / 100);\n    }\n    //now draw the box\n    console.log(\"pagerect\", pagerect);\n    ctx.beginPath();\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = rectColor;\n    ctx.rect(\n      pagerect.left,\n      pagerect.top,\n      pagerect.right - pagerect.left,\n      pagerect.bottom - pagerect.top\n    );\n    ctx.stroke();\n    //Left something broken here, or maybe untested. some component error.  Also, does the wait chris thing turn off?\n    //FIX\n  };\n\n  const clearSelectedImage = () => {\n    imageRef.current.src = \"\";\n    //ERASE CANVAS FIX\n  };\n\n  // Add switches here for rgb/luv and med/median, once I add that to\n  // interface.\n  const plotdata = selected_pages.map((page, i) => [\n    i,\n    ...page.color[data_summary + \"_\" + data_color],\n  ]);\n  const var_label = data_color === \"luv\" ? [\"L\", \"U\", \"V\"] : [\"R\", \"G\", \"B\"];\n\n  return (\n    <div style={{ padding: \"10px\" }}>\n      {selected_pages.length > 0 && (\n        <div>\n          <InstructionDiv>\n            Click on a point in the graph to view the corresponding page.\n            <br />\n            <br />\n            Download your data here:{\" \"}\n            <button onClick={() => download_data(selected_pages)}>Data</button>\n            <br />\n            <div\n              style={{\n                display: \"flex\",\n                \"justify-content\": \"space-evenly\",\n                \"margin-top\": \"10px\",\n              }}\n            >\n              <RadioDiv>\n                <input\n                  type=\"radio\"\n                  value=\"luv\"\n                  id=\"luv\"\n                  onChange={handleColorChange}\n                  name=\"colorpicker\"\n                  checked={data_color == \"luv\" ? \"checked\" : \"\"}\n                />\n                <label for=\"luv\">LUV</label>\n                &nbsp; &nbsp; &nbsp;\n                <input\n                  type=\"radio\"\n                  value=\"rgb\"\n                  id=\"rgb\"\n                  onChange={handleColorChange}\n                  name=\"colorpicker\"\n                  checked={data_color != \"luv\" ? \"checked\" : \"\"}\n                />\n                <label for=\"rgb\">RGB</label>\n              </RadioDiv>\n\n              <RadioDiv>\n                <input\n                  type=\"radio\"\n                  value=\"med\"\n                  id=\"med\"\n                  onChange={handleSummaryChange}\n                  name=\"summarypicker\"\n                  checked={data_summary == \"med\" ? \"checked\" : \"\"}\n                />\n                <label for=\"med\">Median</label>\n                &nbsp; &nbsp; &nbsp;\n                <input\n                  type=\"radio\"\n                  value=\"mean\"\n                  id=\"mean\"\n                  onChange={handleSummaryChange}\n                  name=\"summarypicker\"\n                  checked={data_summary != \"med\" ? \"checked\" : \"\"}\n                />\n                <label for=\"mean\">Mean</label>\n              </RadioDiv>\n\n              {/*  <RadioDiv>\n      <input type=\"radio\" value=\"split\" id=\"split\" onChange={handlePlotwidthChange} name=\"plotwidthpicker\"  checked={plot_width=='split'?\"checked\":\"\"}/>\n      <label for=\"split\">Narrow Plot</label>\n      &nbsp; &nbsp; &nbsp;\n      <input type=\"radio\" value=\"full\" id=\"full\" onChange={handlePlotwidthChange} name=\"plotwidthpicker\" checked={plot_width!='split'?\"checked\":\"\"} />\n      <label for=\"full\">Wide Plot</label>\n</RadioDiv>*/}\n            </div>\n          </InstructionDiv>\n\n          <div\n            style={{ display: \"flex\", margin: \"30px\", \"flex-wrap\": \"wrap\" }}\n          >\n            <div>\n              <Chart\n                width={\"800px\"}\n                height={\"600px\"}\n                chartType=\"Scatter\"\n                data={[[\"Page\", ...var_label], ...plotdata]}\n                options={{\n                  legend: { position: \"bottom\" },\n                  title: \"Test\",\n                  colors: [\"#FF0000\", \"#00FF00\", \"#0000FF\"],\n                }}\n                chartEvents={[\n                  {\n                    eventName: \"select\",\n                    callback: ({ chartWrapper }) => {\n                      const chart = chartWrapper.getChart();\n                      const selection = chart.getSelection();\n                      if (selection.length === 0) {\n                        clearSelectedImage();\n                      }\n                      if (selection.length === 1) {\n                        const [selectedItem] = selection;\n                        //const dataTable = chartWrapper.getDataTable()\n                        const { row, column } = selectedItem;\n                        selectImage(row);\n                      }\n                    },\n                  },\n                ]}\n              />\n            </div>\n            <div style={{ position: \"relative\" }}>\n              <PeekImg\n                ref={imageRef}\n                src=\"\"\n                style={{\n                  position: \"absolute\",\n                  flex: 1,\n                  width: \"500px\",\n                  marginLeft: \"30px\",\n                }}\n              />\n\n              <canvas\n                width={50}\n                height={50}\n                ref={rectCanvasRef}\n                style={{ position: \"absolute\", zIndex: 2, marginLeft: \"30px\" }}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { Table, Tag, Space, List, Typography, Divider } from 'antd';\n\n\nimport {React, useState} from 'react';\nimport styled, { css } from 'styled-components';\n\nimport {Link} from 'react-router-dom';\n\nconst { Text, Title } = Typography;\n\nconst OverviewDiv = styled.div`\npadding-left:10em;\npadding-right:10em;\npadding-top:3em;\nwidth:100%;\n`\n\nconst iiif_libs = [\n\"Internet Archive\",\n\"British Library\",\n\"Harvard University Libraries\",\n\"Cambridge University Libraries\",\n\"Folger Shakespeare Library (Luna)\",\n\"Harry Ransom Center at UT-Austin\"\n]\n\nconst InstructionLi = styled.li`\npadding-top: 0.3em;\npadding-bottom: 0.3em;\n`\n\nconst iiif_sources = [\n  {\nkey: 1,\nlibrary: \"British Library\",\nmanifest: \"https://api.bl.uk/metadata/iiif/ark:/[Piece 1]/[Piece 2]/manifest.json\",\n  },\n  {\nkey: 2,\nlibrary: \"Cambridge\",\nmanifest: \"https://cudl.lib.cam.ac.uk/iiif/[Piece 1]\",\n  },\n  {\nkey: 3,\nlibrary: \"Folger Shakespeare Library\",\nmanifest: \"https://luna.folger.edu/luna/servlet/iiif/m/[Piece 1]/manifest\",\n  },\n  {\nkey: 4,\nlibrary: \"Harry Ransom Center at UT-Austin\",\nmanifest: \"https://norman.hrc.utexas.edu/notDM/objectManifest/[Piece 1]/[Piece 2]/\",\n  },\n  {\nkey: 5,\nlibrary: \"Harvard\",\nmanifest: \"https://iiif.lib.harvard.edu/manifests/[Piece 1]\",\n  },\n  {\nkey: 6,\nlibrary: \"Internet Archive\",\nmanifest: \"https://iiif.archive.org/iiif/[Piece 1]/manifest.json\",\n  }\n]\n\nconst iiif_table_cols = [\n  {\n    title: \"Library\",\n    dataIndex: \"library\",\n    key: \"library\"\n  },\n  {\n    title: \"Manifest Format\",\n    dataIndex: \"manifest\",\n    key: \"manifest\",\n    render: text => <Text code>{text}</Text>\n  }\n]\n\n\nexport default function OverviewPage(props){\n\n  return(\n    <OverviewDiv>\n\n<Title id=\"overview\">Overview</Title>\n\n<Title level={2}>What is this site?</Title>\n\n<p>This beta site is made to help folks dig just a little bit deeper into books they’re curious about.</p>\n<p>Have you ever seen an old book and just had a hunch there’s something interesting about how it was put together? What if the color of its paper–yes paper–offered important clues?</p>\n<p>On this site, developed by researchers at Carnegie Mellon University, you can plug in some details from online rare books repositories and examine the color profile of every page in the book.</p>\n<p>Maybe your book was printed in two different shops? Maybe it was printed in two different eras? Maybe someone inserted some illicit sheets after it had passed the censors?</p>\n<p>If so, chances are you’ll see those kinds of things in the data.</p>\n<p>Give it a try.</p>\n<Title level={2} id=\"instructions\">Instructions</Title>\n<p>This tool currently works from IIIF-manifests from the following rare books repositories:</p>\n\n<Table columns={iiif_table_cols} dataSource={iiif_sources}/>\n\n<p>IIIF-manifests for each of these libraries takes the specified form, where the part(s) in <code>[ ]</code> brackets are unique identifiers.</p>\n\n    <ol type=\"1\">\n<InstructionLi>Locate the unique identifier(s) for your book and input them in the tool on the \"Input Manifest\" page.</InstructionLi>\n<InstructionLi>After a short wait, you’ll see a page that randomly mashes a sample of your book’s pages together. This is normal! The purpose is to help you <strong>find a spot in the resulting image that’s just paper</strong> (no text).<br />\n</InstructionLi>\n<InstructionLi>Use your mouse to draw a small rectangle in a region that is likely to be blank on most pages. What’ll soon happen in the background is that it’ll calculate the average color at these coordinates on every single page in book (manifest, really). So you want it to be as uniform as possible (apples to apples, etc).</InstructionLi>\n<InstructionLi>Click “Use this rectangle” <br/>\n    <a href=\"demo_rect_select_small.gif\" target=\"_blank\">View demo of rectangle selection [opens in new window]</a></InstructionLi>\n<InstructionLi>The next step is an optional filtering step. Maybe there are binding images or endpaper images you don’t want. Maybe you’ve accidentally captured a catchword or a signature mark. These will throw off your averages. You can delete or modify your rectangles one by one by clicking the delete button or the edit button on an individual image.</InstructionLi>\n    <a href=\"demo_page_correct_small.gif\" target=\"_blank\">View demo of rectangle adjustment [opens in new window]</a>\n<InstructionLi><p>Click “View Plot” or “Extract Color Information.” The plot on the left is keyed to images on the right. Click a point and see its associated image.</p></InstructionLi>\n<InstructionLi><p>Explore LUV, RGB, median, and mean permutations.</p></InstructionLi>\n<InstructionLi><p>Download your data. The tool doesn’t currently store your history, so you won't be able to come back to this set of rectangle selections. Downloading your data is at present the only way to document your results and make them persist.</p></InstructionLi>\n</ol>\n<Title level={2} id=\"find-something-interesting-please-share\">Find Something Interesting? Please share!</Title>\n<p>We love to hear about interesting examples! We’d even love to use some examples in our papers. If you find something cool, by all means let us know. You can email us at cnwarren at cmu dot edu or tag us on Twitter <span class=\"citation\" data-cites=\"chrisvvarren\">@chrisvvarren</span> or <span class=\"citation\" data-cites=\"sammuellemey\">@sammuellemey</span>.</p>\n<Title level={2} id=\"for-libraries\">For Libraries</Title>\n<p>Want researchers to be able to use this tool for your collections? Make sure your IIIF platform has CORS enabled and let us know where we can find your manifests via the email addresses above.</p>\n<Title level={2} id=\"disclaimer\">Disclaimer</Title>\n    <p>This tool is currently unpolished and a bit unstable.  (Max wrote it while sitting up with a sleepless infant, with all of the careful planning and attention to detail that implies.)  We welcome feedback about bugs or potential improvements, but are also currently limited in the time that we have available for development.  If you are comfortable with React and would like to contribute, let us know!</p>\n<Title level={2} id=\"credits\">Credits</Title>\n<p>Developed primarily by <a href=\"https://www.andrew.cmu.edu/user/mgsell/\">Max G’Sell</a> with input from <a href=\"http://samuellemley.com/\">Samuel Lemley</a>, <a href=\"https://www.cmu.edu/dietrich/english/about-us/faculty/bios/warren-christopher.html\">Christopher Warren</a>, and <a href=\"http://matthewlincoln.net/\">Matthew Lincoln</a> as part of the Print &amp; Probability research project. Intro and instructions by Chris Warren.</p>\n\n\n    </OverviewDiv>\n  );\n}\n\n","import React from 'react';\nimport {useState} from 'react';\nimport styled, { css } from 'styled-components';\nimport ManifestSelector from './ManifestSelector.jsx';\n//import Plot from 'react-plotly';\nimport TopBar from './TopBar.jsx';\nimport MarginMarker from './MarginMarker.jsx';\nimport ScrapTable from './ScrapTable.jsx';\nimport PaperPlot from './PaperPlot.jsx';\nimport OverviewPage from './OverviewPage.jsx';\n\nimport { BrowserRouter as Router , Route, Switch, Redirect} from 'react-router-dom';\n\n\n\nconst BodyDiv=styled.div`\n/*position:fixed;*/\n/*top: 200px;*/\nleft: 0;\nright:0;\nheight:100%;\noverflow-y: scroll;\n`\n\n\n\nexport default function App(props){\n  //Right now, this gets populated when I fetch the manifest, but I \n  //don't actually use it, since I'm passing that list in state\n  //Remove eventually if I don't need it after I switch to redux\n  \n  console.log('Render App');\n\n  return(\n    <div className='app'>\n    <Router>\n    <TopBar/>\n    <BodyDiv>\n    <Switch>\n    <Route exact path=\"/\" component={OverviewPage}\n    />\n    <Route path=\"/manifest\" component={ManifestSelector}\n    />\n    <Route path=\"/rect\" render={(props)=>\n      <MarginMarker {...props}/>\n    }/>\n    <Route path=\"/scraps\" render={(props)=>\n      <ScrapTable {...props} />\n    }/>\n    <Route path=\"/plot\" render={(props)=>\n      <PaperPlot {...props} />\n    }/>\n    </Switch>\n\n\n    </BodyDiv>\n    </Router>\n    </div>\n  );\n}\n","import { combineReducers } from '@reduxjs/toolkit'\nimport pagesReducer from './pagesSlice'\nimport bookReducer from './bookSlice'\n\nconst rootReducer = combineReducers({\n  pages : pagesReducer,\n  book : bookReducer\n})\n\nexport default rootReducer\n","import { configureStore } from '@reduxjs/toolkit'\n\nimport rootReducer from './rootReducer'\n\nconst store = configureStore({\n  reducer: rootReducer\n})\n\nexport default store\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux'\nimport App from './components/App.jsx';\n\nimport store from './redux/store'\n\n//import './Reset.css';\n\n\nimport 'antd/dist/antd.css'; // or 'antd/dist/antd.less'\n\nimport './index.css';\n\nReactDOM.render(\n  <Provider store={store}>\n  <App />\n  </Provider>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}