(this.webpackJsonpcolor_mapper=this.webpackJsonpcolor_mapper||[]).push([[0],{244:function(e,t,n){},245:function(e,t,n){"use strict";n.r(t);var r,i,a,c,o,s=n(0),l=n.n(s),d=n(36),u=n.n(d),b=n(29),h=n(3),j=n(25),p=n(26),f=n(4),m=n(45),x=n(71),g=Object(x.b)({name:"book",initialState:{lib:"",url1:"",url2:"",manifest_url:"",usePercent:!0,roundPercent:!0},reducers:{setLib:function(e,t){e.lib=t.payload},setURL:function(e,t){e.url1=t.payload.url1,t.payload.url2&&(e.url2=t.payload.url2)},setManifestURL:function(e,t){e.manifest_url=t.payload},setIIIF:function(e,t){e.usePercent=t.payload.usePercent,e.roundPercent=t.payload.roundPercent}}}),O=function(e){return[e.book.lib,e.book.url1,e.book.url2]},v=g.actions,y=v.setLib,w=v.setURL,k=(v.setManifestURL,v.setIIIF),M=g.reducer,R=n(6),I=p.a.div(r||(r=Object(j.a)(["\ndisplay:flex;\n"]))),P=function(e){var t=!0;return"HRC"==e&&(t=!1),{usePercent:t,roundPercent:!0}};function C(e){var t=Object(b.b)(),n=Object(s.useState)(""),r=Object(f.a)(n,2),i=r[0],a=r[1],c=Object(s.useState)(""),o=Object(f.a)(c,2),l=o[0],d=o[1],u=Object(s.useState)(""),h=Object(f.a)(u,2),j=h[0],p=h[1],x=function(e){var t=e.target,n=t.name,r=t.value;"libPick"===n?a(r):"url1"===n?d(r):"url2"===n&&p(r)};return Object(R.jsx)(I,{children:Object(R.jsxs)("form",{style:{padding:"20px"},children:[Object(R.jsxs)("label",{children:["Pick your library:",Object(R.jsxs)("select",{name:"libPick",value:i,onChange:x,children:[Object(R.jsx)("option",{value:""}),Object(R.jsx)("option",{value:"HRC",children:"HRC"}),Object(R.jsx)("option",{value:"BL",children:"BL"}),Object(R.jsx)("option",{value:"Harvard",children:"Harvard"}),Object(R.jsx)("option",{value:"Cambridge",children:"Cambridge"}),Object(R.jsx)("option",{value:"IA",children:"Internet Archive"}),Object(R.jsx)("option",{value:"Folger",children:"Folger"}),Object(R.jsx)("option",{value:"Internal",children:"Internal"}),Object(R.jsx)("option",{value:"Experimental",children:"Experimental"})]})]}),Object(R.jsx)("br",{}),""!==i&&Object(R.jsxs)("div",{children:[Object(R.jsx)("br",{}),Object(R.jsx)("p",{children:"Specify Manifest:"}),Object(R.jsx)("br",{}),"HRC"===i&&Object(R.jsxs)("p",{children:["https://norman.hrc.utexas.edu/notDM/objectManifest/[Piece 1]/[Piece 2]/",Object(R.jsx)("br",{}),Object(R.jsx)("br",{})]}),"BL"===i&&Object(R.jsx)("p",{children:"https://api.bl.uk/metadata/iiif/ark:/[Piece 1]/[Piece 2]/manifest.json"}),"Harvard"===i&&Object(R.jsx)("p",{children:"https://iiif.lib.harvard.edu/manifests/[Piece 1]"}),"Cambridge"===i&&Object(R.jsx)("p",{children:"https://cudl.lib.cam.ac.uk/iiif/[Piece 1]"}),"IA"===i&&Object(R.jsx)("p",{children:"https://iiif.archive.org/iiif/[Piece 1]/manifest.json"}),"Folger"===i&&Object(R.jsx)("p",{children:"https://luna.folger.edu/luna/servlet/iiif/m/[Piece 1]/manifest"}),"Internal"===i&&Object(R.jsx)("p",{children:"Internal use only"}),"Experimental"===i&&Object(R.jsx)("p",{children:"This uses an experimental manifest parser.  You probably want one of the other choices, unless I have asked you to test this."}),Object(R.jsx)("br",{}),Object(R.jsxs)("label",{children:["URL Piece 1:",Object(R.jsx)("input",{name:"url1",type:"text",value:l,onChange:x})]}),"\xa0\xa0\xa0","Harvard"!==i&&"Cambridge"!==i&&"IA"!==i&&"Folger"!==i&&"Internal"!==i&&"Experimental"!==i&&Object(R.jsxs)("label",{children:["URL Piece 2:",Object(R.jsx)("input",{name:"url2",type:"text",value:j,onChange:x})]}),Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),Object(R.jsx)(m.b,{to:"/rect/",children:Object(R.jsx)("button",{onClick:function(){t(w({url1:l,url2:j})),t(y(i)),t(k(P(i)))},children:"Use this manifest"})})]})]})})}var _=p.a.div(i||(i=Object(j.a)(["\n/*display: fixed;*/\ndisplay:relative;\ntop: 0;\nleft: 0;\nright: 0;\npadding-bottom: 15px;\nheight: 10em;\n/*background: #eeeeee;*/\nbackground-image: url('../../blankpaper.jpg');\n"]))),S=p.a.h1(a||(a=Object(j.a)(["\nfont-size: xxx-large;\ncolor: #333333;\nwidth:100%;\ndisplay: inline-block;\nmargin: 10px;\n"]))),L=p.a.div(c||(c=Object(j.a)(["\ndisplay: flex;\nflex-direction: row;\nposition:absolute;\nwidth: 100%;\ntop: 0;\nleft: 0;\nright: 0;\nz-index: 2;\nflex-wrap: wrap;\n"]))),F=Object(p.a)(m.c)(o||(o=Object(j.a)(["\nflex: 1;\nbackground: white;\ntext-decoration: none;\ncolor:black;\ndisplay: inline-block;\nborder: 2px solid green;\nborder-radius: 3px;\nmargin: 5px;\npadding: 5px;\ntext-align: center;\n"])));function U(e){return Object(R.jsx)(_,{children:Object(R.jsxs)(L,{children:[Object(R.jsx)(S,{children:"Coloring Book"}),Object(R.jsx)(F,{to:"/",children:"Overview"}),Object(R.jsx)(F,{to:"/manifest",children:"Input Manifest"}),Object(R.jsx)(F,{to:"/rect",children:"Select Rectangle"}),Object(R.jsx)(F,{to:"/scraps",children:"Edit Rectangles"}),Object(R.jsx)(F,{to:"/plot",children:"View Plot"})]})})}var H,T=n(42),E=n(64),q=n(7),D=p.a.div(H||(H=Object(j.a)(["\nleft:0;\n&:before,\n&:after {\n   content: '\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n"],["\nleft:0;\n&:before,\n&:after {\n   content: '\\\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n"])));function B(e){var t=Object(s.useRef)(),n=Object(s.useRef)(),r=(Object(s.useRef)(),Object(s.useState)({width:"100%",height:"100%"})),i=Object(f.a)(r,2),a=(i[0],i[1],Object(s.useState)({width:null,height:null})),c=Object(f.a)(a,2),o=c[0],d=c[1],u=Object(s.useState)(!1),h=Object(f.a)(u,2),j=h[0],p=h[1],m=Object(b.c)((function(e){return e.book.usePercent})),x=Object(b.c)((function(e){return e.book.roundPercent})),g=Object(s.useMemo)((function(){return e.img_urls.map((function(){return l.a.createRef()}))}),[e.img_urls.join(",")]),O=Object(s.useState)(0),v=Object(f.a)(O,2),y=v[0],w=v[1],k=!1,M=null,I=null,P=null,C=null,_=function(){y+1>=e.img_urls.length&&S(),w((function(e){return e+1}))};Object(s.useEffect)((function(){t.current.getContext("2d").fillText("Please wait, loading...",100,10)}),[]);var S=function(){var e=Math.max.apply(Math,Object(q.a)(g.map((function(e){return e.current.width})))),r=Math.max.apply(Math,Object(q.a)(g.map((function(e){return e.current.height})))),i=t.current,a=n.current,c=i.getContext("2d");a.getContext("2d");i.width=e,i.height=r,a.width=e,a.height=r,c.fillStyle="white",c.fillRect(0,0,e,r);for(var o=c.getImageData(0,0,e,r),s=0;s<g.length;s++){c.drawImage(g[s].current,0,0);for(var l=c.getImageData(0,0,e,r),u=0;u<o.data.length;u+=4)o.data[u+0]=Math.min(o.data[u+0],l.data[u+0]),o.data[u+1]=Math.min(o.data[u+0],l.data[u+0]),o.data[u+2]=Math.min(o.data[u+0],l.data[u+0]),o.data[u+3]=255}c.putImageData(o,0,0),d({width:e,height:r}),p(!0)},L=function(){var e=n.current.getContext("2d");e.clearRect(0,0,o.width,o.height),e.beginPath(),e.lineWidth=5,e.strokeStyle="#FF0000",e.rect(1*M,1*I,1*P-1*M,1*C-1*I),e.stroke()},F=function(t){if(j&&k){k=!1;var r=n.current,i=U(r,t),a=Object(f.a)(i,2);P=a[0],C=a[1],L();var c=Math.round(Math.min(M,P)),s=Math.round(Math.max(M,P)),l=Math.round(Math.min(I,C)),d={left:c,right:s,bottom:Math.round(Math.max(I,C)),top:l};m&&(d.left=d.left/o.width*100,d.right=d.right/o.width*100,d.top=d.top/o.height*100,d.bottom=d.bottom/o.height*100,x&&(d.left=Math.round(d.left),d.right=Math.round(d.right),d.top=Math.round(d.top),d.bottom=Math.round(d.bottom))),e.recordRect(d)}},U=function(e,t){var r=e.getBoundingClientRect(),i=n.current;return[(t.clientX-r.left)/(r.right-r.left)*i.width,(t.clientY-r.top)/(r.bottom-r.top)*i.height]};return Object(R.jsxs)(D,{children:[Object(R.jsx)("canvas",{ref:t,style:{position:"absolute",width:"100%",display:"block",zIndex:1}}),Object(R.jsx)("canvas",{width:1e3,height:500,ref:n,style:{position:"absolute",width:"100%",display:"inline-block",zIndex:2},onMouseDown:function(e){if(j){var t=n.current,r=U(t,e),i=Object(f.a)(r,2);M=i[0],I=i[1],k=!0,U(t,e)}},onMouseMove:function(e){if(j&&k){var t=n.current,r=U(t,e),i=Object(f.a)(r,2);P=i[0],C=i[1],L()}},onMouseUp:F,onMouseOut:function(e){F(e)}}),e.img_urls.map((function(e,t){return Object(R.jsx)("img",{crossOrigin:"anonymous",ref:g[t],src:e,onLoad:_,style:{visibility:"hidden",position:"fixed"}},e)}))]})}var W,z,A,V=Object(x.b)({name:"pages",initialState:[],reducers:{setPagesFromURLs:function(e,t){return t.payload.map((function(e,t){return{url:e,rect:{},isSelected:!0,index:t,color:{}}}))},setDefaultRect:function(e,t){e.forEach((function(e){return e.rect=t.payload}))},setRect:function(e,t){var n=t.payload,r=n.id,i=n.new_rect;e.find((function(e){return e.index===r})).rect=i},setPageColor:function(e,t){var n=t.payload,r=n.id,i=n.color;e.find((function(e){return e.index===r})).color=i},toggleSelected:function(e,t){var n=e.find((function(e){return e.index===t.payload}));n.isSelected=!n.isSelected}}}),G=function(e){return e.pages.filter((function(e){return e.isSelected}))},Y=V.actions,J=Y.setPagesFromURLs,N=Y.setDefaultRect,X=Y.setRect,K=Y.toggleSelected,Q=Y.setPageColor,Z=V.reducer,$=p.a.div(W||(W=Object(j.a)(["\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: justify;\n  margin: 20px auto;\n  padding: 20px;\n"]))),ee=Object(p.a)(m.b)(z||(z=Object(j.a)(["\nflex: 1;\nbackground: white;\ncolor:black;\ndisplay: inline-block;\nborder: 2px solid green;\nborder-radius: 3px;\nmargin: 5px;\npadding: 5px;\ntext-align: center;\n"]))),te=p.a.div(A||(A=Object(j.a)(["\n&:before,\n&:after {\n   content: '\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n"],["\n&:before,\n&:after {\n   content: '\\\\0020';\n   display: block;\n   overflow: hidden;\n   visibility: hidden;\n   width: 0;\n   height: 0;\n}\n&:after { clear: both; }\nzoom: 1; \n"]))),ne=function(e,t,n){return"HRC"===e?"https://norman.hrc.utexas.edu/notDM/objectManifest/"+t+"/"+n+"/":"BL"===e?"https://api.bl.uk/metadata/iiif/ark:/"+t+"/"+n+"/manifest.json":"Harvard"===e?"https://iiif.lib.harvard.edu/manifests/"+t:"Cambridge"===e?"https://cudl.lib.cam.ac.uk/iiif/"+t:"IA"===e?"https://iiif.archive.org/iiif/"+t+"/manifest.json":"Folger"===e?"https://luna.folger.edu/luna/servlet/iiif/m/"+t+"/manifest":"Internal"==e||"Experimental"==e?t:void console.log("Oh sad, not the library!")},re=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]}))},ie=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0]["@id"]}))},ae=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]}))},ce=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]}))},oe=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]})).map((function(e){return e+"/full/full/0/default.jpg"}))},se=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]}))},le=function(e){return e.sequences[0].canvases.map((function(e){return e.images[0].resource["@id"]}))},de=function(e){var t=[];if(e.sequences&&e.sequences[0].canvases)for(var n=e.sequences[0].canvases,r=0;r<n.length;r++){var i=n[r].images;if(i&&i.length>0){var a=i[0].resource;if(a){var c=a["@id"]||i[0]["@id"];if(c){var o=-1!==c.indexOf("cam.ac.uk"),s=-1!==c.indexOf("library.cmu.edu");o?c+="/full/full/0/default.jpg":s&&(c=a.service["@id"],c+="/full/full/0/default.jpg"),t.push(c)}}}}return t};function ue(e){var t=Object(s.useState)(!1),n=Object(f.a)(t,2),r=n[0],i=n[1],a=Object(s.useState)({}),c=Object(f.a)(a,2),o=c[0],l=c[1],d=Object(b.c)(O),u=Object(f.a)(d,3),h=u[0],j=u[1],p=u[2],m=Object(b.c)((function(e){return e.pages.map((function(e){return e.url}))})),x=(Object(b.c)((function(e){return e.book.usePercent})),Object(b.b)());Object(s.useEffect)((function(){var e=function(){var e=Object(E.a)(Object(T.a)().mark((function e(t,n,r){var a,c,o,s;return Object(T.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=ne(t,n,r),console.log("Requesting: "+a),e.next=4,fetch(a);case 4:if(!((c=e.sent).status>=400)){e.next=8;break}throw console.log("bad response: "+c.status),new Error("Bad response to manifest request");case 8:return e.next=10,c.json();case 10:o=e.sent,s=[],"HRC"===t?s=ie(o):"BL"==t?s=ae(o):"Harvard"==t?s=ce(o):"Internal"==t?s=re(o):"Experimental"==t?s=de(o):"Cambridge"==t?s=oe(o):"IA"==t?s=se(o):"Folger"==t&&(s=le(o)),x(J(s)),i(!0);case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();e(h,j,p)}),[h,j,p]);o.top,o.bottom,o.left,o.right;return Object(R.jsxs)("div",{children:[!r&&Object(R.jsx)($,{children:"Please wait, requesting manifest.  This can take up to a minute for some library servers."}),r&&Object(R.jsxs)(te,{children:[Object(R.jsxs)($,{children:["A sample of pages are superimposed below.  Select a rectangle from the top or bottom margin of the page that consistently excludes text and other marks.  Side margins do not work as well because we ignore recto/verso distinctions.",Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),Object(R.jsx)(ee,{to:{pathname:"/scraps"},children:"Use this rectangle"})]}),Object(R.jsx)(B,{recordRect:function(e){x(N(e)),l(e)},roundPercent:"HRC"!==h,img_urls:m.filter((function(e,t){return(t-4)%Math.floor((m.length-8)/7)===0}))})]})]})}var be,he,je,pe,fe,me,xe=n(142),ge=n.n(xe),Oe=n(31),ve=p.a.div(be||(be=Object(j.a)(["\n  position: relative;\n  width: 400px;\n  margin-left: 10px;\n  margin-right: 10px;\n  margin-top: 5px;\n  margin-bottom: 5px;\n  ","\n\n"])),(function(e){return!e.cancelled&&"\n  color='gray';\n  background='gray';\n  z-index: 10;\n  "})),ye=p.a.img(he||(he=Object(j.a)(["\n  width: 100%;\n  height: auto;\n  z-index: 1;\n  ","\n","\n"])),(function(e){return e.cancelled&&"\n  opacity: 0.1;\n  border-color: black;\n  border-width: 1px;\n  border-style: dotted;\n  padding: 0;\n  "}),(function(e){return!e.cancelled&&"\n  padding: 1px;\n  "})),we=p.a.img(je||(je=Object(j.a)(["\n  position: absolute;\n  right: 2px;\n  top: 2px;\n  z-index: 2;\n  ","\n"])),(function(e){return!e.active&&"\n  visibility: hidden;\n  "})),ke=p.a.img(pe||(pe=Object(j.a)(["\n  position: absolute;\n  top: 2px;\n  left: 2px;\n  z-index: 2;\n","\n"])),(function(e){return!e.active&&"\n  visibility: hidden;\n  "}));function Me(e){var t=Object(b.b)(),n=Object(s.useState)(!1),r=Object(f.a)(n,2),i=r[0],a=r[1],c=Object(b.c)((function(e){return e.book.usePercent})),o=Object(b.c)((function(t){return!t.pages.find((function(t){return t.index==e.index})).isSelected})),l=Object(b.c)((function(t){return t.pages.find((function(t){return t.index==e.index})).rect})),d=Object(b.c)((function(t){return t.pages.find((function(t){return t.index==e.index})).url})),u=(Object(b.c)((function(e){return e.book.lib})),(c?"pct:":"")+[l.left,l.top,l.right-l.left,l.bottom-l.top].join(",")),h=d.split("full")[0],j=(h+="/"===h[h.length-1]?"":"/")+u+"/full/0/default.jpg",p=o?"/add_icon_small.png":"/delete_icon_small.png";return Object(R.jsxs)(ve,{onMouseEnter:function(){return a(!0)},onMouseLeave:function(){return a(!1)},cancelled:o,children:[Object(R.jsx)(ye,{idx:e.index,ref:e.imageRef,crossOrigin:"anonymous",src:j,cancelled:o,onLoad:e.process},e.index),Object(R.jsx)(ke,{active:i,onClick:e.editRect,width:"25px",height:"25px",src:"/edit_icon_small.png"}),Object(R.jsx)(we,{active:i,onClick:function(n){t(K(e.index))},width:"25px",height:"25px",src:p})]})}function Re(e){return function(e){var t=e[0],n=e[1],r=e[2],i=[95.05,100,108.9],a=i[0],c=i[1],o=i[2],s=9*c/(a+15*c+3*o),l=4*a/(a+15*c+3*o);if(0===t&&0===n&&0===r)return[0,0,0];var d=9*n/(t+15*n+3*r),u=4*t/(t+15*n+3*r),b=n/c,h=null!=Math.cbrt?Math.cbrt:function(e){return Math.pow(e,1/3)},j=b>216/24389?116*h(b,1/3)-16:24389/27*b;return[j+0,13*j*(u-l)+0,13*j*(d-s)+0]}(function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},a=i(t),c=i(n),o=i(r);return[100*(.4124*a+.3576*c+.1805*o)+0,100*(.2126*a+.7152*c+.0722*o)+0,100*(.0193*a+.1192*c+.9505*o)+0]}(e))}function Ie(e){var t=e.slice().sort((function(e,t){return e-t})),n=Math.floor(t.length/2);return t.length%2===0?(t[n-1]+t[n])/2:t[n]}function Pe(e){return e.reduce((function(e,t){return e+t}))/e.length}var Ce=p.a.div(fe||(fe=Object(j.a)(["\n  display: flex;\n  justify-content: center;\n  flex-direction: row;\n  background: #eeeeee;\n  flex-wrap: wrap;\n  padding-bottom: 50px;\n  padding-top: 25px;\n"]))),_e={overlay:{zIndex:1e3,backgroundColor:"gray"}},Se=p.a.div(me||(me=Object(j.a)(["\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: justify;\n  margin: 20px auto;\n  padding: 20px;\n"])));function Le(e){var t=Object(b.b)(),n=(Object(Oe.f)(),Object(s.useRef)()),r=Object(s.useState)({modal:!1,index:null}),i=Object(f.a)(r,2),a=i[0],c=i[1],o=Object(s.useState)(0),d=Object(f.a)(o,2),u=d[0],h=d[1],j=Object(b.c)((function(e){return e.book.lib})),p=Object(b.c)((function(e){return e.pages.map((function(e){return e.url}))})),x=Object(s.useMemo)((function(){return p.map((function(){return l.a.createRef()}))}),[p.length,p]),g=function(e){var r=function(e){for(var t=[],n=[],r=[],i=[],a=[],c=[],o=0;o<e.length;o+=4){var s=e.slice(o,o+3);t.push(s[0]),n.push(s[1]),r.push(s[2]);var l=Re(s);i.push(l[0]),a.push(l[1]),c.push(l[2])}return{med_rgb:[Ie(t),Ie(n),Ie(r)],med_luv:[Ie(i),Ie(a),Ie(c)],mean_rgb:[Pe(t),Pe(n),Pe(r)],mean_luv:[Pe(i),Pe(a),Pe(c)]}}(function(e){var t=n.current,r=t.getContext("2d"),i=e.current.naturalHeight,a=e.current.naturalWidth;return t.width=a,t.height=i,r.drawImage(e.current,0,0),r.getImageData(0,0,a,i).data}(x[e]));t(Q({id:e,color:r})),h((function(e){return e+1}))};return Object(R.jsxs)("div",{children:[Object(R.jsxs)("div",{style:{textAlign:"center"},children:[Object(R.jsxs)(Se,{children:["Remove any unwanted pages, and correct any poorly-cropped pages.  Try to select sections of paper without ink or stains, while keeping selections in approximately the same region of the page.",Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),"When you are satisfied, proceed here:",Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),u>=p.length&&Object(R.jsx)(m.b,{to:{pathname:"/plot/"},children:Object(R.jsx)("button",{children:"Extract Color Information"})}),u<p.length&&Object(R.jsx)("p",{children:"Please wait until all pages have loaded below."})]}),Object(R.jsx)("div",{children:Object(R.jsx)(Ce,{children:x.map((function(e,t){return Object(R.jsx)(Me,{index:t,imageRef:e,process:function(){return g(t)},editRect:function(){return function(e){c({modal:!0,index:e})}(t)}},t)}))})}),Object(R.jsx)("canvas",{ref:n,width:"100px",height:"100px",style:{visibility:"hidden"}})]}),Object(R.jsx)(ge.a,{isOpen:a.modal,style:_e,onRequestClose:function(){c({modal:!1,index:null})},children:Object(R.jsx)(B,{usePercent:e.usePercent&&"HRC"!==j,roundPercent:"HRC"!==j,img_urls:[p[a.index]],recordRect:function(e){return function(e,n){t(X({id:e,new_rect:n}))}(a.index,e)}})})]})}var Fe,Ue,He,Te=n(143),Ee=p.a.img(Fe||(Fe=Object(j.a)(["\n  ","\n"])),(function(e){return e.hiding&&"\n  visibility: hidden;\n  "})),qe=p.a.div(Ue||(Ue=Object(j.a)(["\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  max-width: 800px;\n  text-align: center;\n  margin: 20px auto;\n  padding: 20px;\n"]))),De=p.a.div(He||(He=Object(j.a)(["\n  background: #eeeeee;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #cccccc;\n  text-align: center;\n  margin: 10px;\n  padding: 10px;\n"]))),Be=function(e){var t="index,rect_left,rect_right,rect_bottom,rect_top,med_L,med_U,med_V,med_R,med_G,med_B,mean_L,mean_U,mean_V,mean_R,mean_G,mean_B,URL\n";t="data:text/csv;charset=utf-8,"+(t+=e.map((function(e){return[e.index,e.rect.left,e.rect.right,e.rect.bottom,e.rect.top].concat(Object(q.a)(e.color.med_luv),Object(q.a)(e.color.med_rgb),Object(q.a)(e.color.mean_luv),Object(q.a)(e.color.mean_rgb),[e.url]).join(",")+"\n"})).reduce((function(e,t){return e+t})));var n=encodeURI(t),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download","export.csv"),r.click()};function We(e){var t=Object(s.useRef)(),n=Object(s.useRef)(),r=Object(b.c)((function(e){return e.book.usePercent})),i=Object(s.useState)("luv"),a=Object(f.a)(i,2),c=a[0],o=a[1],l=Object(s.useState)("med"),d=Object(f.a)(l,2),u=d[0],h=d[1],j=Object(s.useState)("split"),p=Object(f.a)(j,2),m=(p[0],p[1],Object(b.c)((function(e){return e.book.lib})),Object(b.c)(G)),x=function(e){o(e.target.value)},g=function(e){h(e.target.value)},O=m.map((function(e,t){return[t].concat(Object(q.a)(e.color[u+"_"+c]))})),v="luv"===c?["L","U","V"]:["R","G","B"];return Object(R.jsx)("div",{style:{padding:"10px"},children:m.length>0&&Object(R.jsxs)("div",{children:[Object(R.jsxs)(qe,{children:["Click on a point in the graph to view the corresponding page.",Object(R.jsx)("br",{}),Object(R.jsx)("br",{}),"Download your data here:"," ",Object(R.jsx)("button",{onClick:function(){return Be(m)},children:"Data"}),Object(R.jsx)("br",{}),Object(R.jsxs)("div",{style:{display:"flex","justify-content":"space-evenly","margin-top":"10px"},children:[Object(R.jsxs)(De,{children:[Object(R.jsx)("input",{type:"radio",value:"luv",id:"luv",onChange:x,name:"colorpicker",checked:"luv"==c?"checked":""}),Object(R.jsx)("label",{for:"luv",children:"LUV"}),"\xa0 \xa0 \xa0",Object(R.jsx)("input",{type:"radio",value:"rgb",id:"rgb",onChange:x,name:"colorpicker",checked:"luv"!=c?"checked":""}),Object(R.jsx)("label",{for:"rgb",children:"RGB"})]}),Object(R.jsxs)(De,{children:[Object(R.jsx)("input",{type:"radio",value:"med",id:"med",onChange:g,name:"summarypicker",checked:"med"==u?"checked":""}),Object(R.jsx)("label",{for:"med",children:"Median"}),"\xa0 \xa0 \xa0",Object(R.jsx)("input",{type:"radio",value:"mean",id:"mean",onChange:g,name:"summarypicker",checked:"med"!=u?"checked":""}),Object(R.jsx)("label",{for:"mean",children:"Mean"})]})]})]}),Object(R.jsxs)("div",{style:{display:"flex",margin:"30px","flex-wrap":"wrap"},children:[Object(R.jsx)("div",{children:Object(R.jsx)(Te.a,{width:"800px",height:"600px",chartType:"Scatter",data:[["Page"].concat(v)].concat(Object(q.a)(O)),options:{legend:{position:"bottom"},title:"Test",colors:["#FF0000","#00FF00","#0000FF"]},chartEvents:[{eventName:"select",callback:function(e){var i=e.chartWrapper.getChart().getSelection();if(0===i.length&&(t.current.src=""),1===i.length){var a=Object(f.a)(i,1)[0],c=a.row;a.column;!function(e){var i=m[e].url.replace("full/full","full/500,");t.current.src=i;var a=m[e].rect,c=n.current,o=c.getContext("2d"),s=t.current.naturalHeight,l=t.current.naturalWidth;c.width=l,c.height=s,r&&(a.top=Math.round(a.top*s/100),a.bottom=Math.round(a.bottom*s/100),a.left=Math.round(a.left*l/100),a.right=Math.round(a.right*l/100)),console.log("pagerect",a),o.beginPath(),o.lineWidth=5,o.strokeStyle="#00ff00",o.rect(a.left,a.top,a.right-a.left,a.bottom-a.top),o.stroke()}(c)}}}]})}),Object(R.jsxs)("div",{style:{position:"relative"},children:[Object(R.jsx)(Ee,{ref:t,src:"",style:{position:"absolute",flex:1,width:"500px",marginLeft:"30px"}}),Object(R.jsx)("canvas",{width:50,height:50,ref:n,style:{position:"absolute",zIndex:2,marginLeft:"30px"}})]})]})]})})}var ze,Ae,Ve,Ge=n(249),Ye=n(248),Je=Ge.a.Text,Ne=Ge.a.Title,Xe=p.a.div(ze||(ze=Object(j.a)(["\npadding-left:10em;\npadding-right:10em;\npadding-top:3em;\nwidth:100%;\n"]))),Ke=p.a.li(Ae||(Ae=Object(j.a)(["\npadding-top: 0.3em;\npadding-bottom: 0.3em;\n"]))),Qe=[{key:1,library:"British Library",manifest:"https://api.bl.uk/metadata/iiif/ark:/[Piece 1]/[Piece 2]/manifest.json"},{key:2,library:"Cambridge",manifest:"https://cudl.lib.cam.ac.uk/iiif/[Piece 1]"},{key:3,library:"Folger Shakespeare Library",manifest:"https://luna.folger.edu/luna/servlet/iiif/m/[Piece 1]/manifest"},{key:4,library:"Harry Ransom Center at UT-Austin",manifest:"https://norman.hrc.utexas.edu/notDM/objectManifest/[Piece 1]/[Piece 2]/"},{key:5,library:"Harvard",manifest:"https://iiif.lib.harvard.edu/manifests/[Piece 1]"},{key:6,library:"Internet Archive",manifest:"https://iiif.archive.org/iiif/[Piece 1]/manifest.json"}],Ze=[{title:"Library",dataIndex:"library",key:"library"},{title:"Manifest Format",dataIndex:"manifest",key:"manifest",render:function(e){return Object(R.jsx)(Je,{code:!0,children:e})}}];function $e(e){return Object(R.jsxs)(Xe,{children:[Object(R.jsx)(Ne,{id:"overview",children:"Overview"}),Object(R.jsx)(Ne,{level:2,children:"What is this site?"}),Object(R.jsx)("p",{children:"This beta site is made to help folks dig just a little bit deeper into books they\u2019re curious about."}),Object(R.jsx)("p",{children:"Have you ever seen an old book and just had a hunch there\u2019s something interesting about how it was put together? What if the color of its paper\u2013yes paper\u2013offered important clues?"}),Object(R.jsx)("p",{children:"On this site, developed by researchers at Carnegie Mellon University, you can plug in some details from online rare books repositories and examine the color profile of every page in the book."}),Object(R.jsx)("p",{children:"Maybe your book was printed in two different shops? Maybe it was printed in two different eras? Maybe someone inserted some illicit sheets after it had passed the censors?"}),Object(R.jsx)("p",{children:"If so, chances are you\u2019ll see those kinds of things in the data."}),Object(R.jsx)("p",{children:"Give it a try."}),Object(R.jsx)(Ne,{level:2,id:"instructions",children:"Instructions"}),Object(R.jsx)("p",{children:"This tool currently works from IIIF-manifests from the following rare books repositories:"}),Object(R.jsx)(Ye.a,{columns:Ze,dataSource:Qe}),Object(R.jsxs)("p",{children:["IIIF-manifests for each of these libraries takes the specified form, where the part(s) in ",Object(R.jsx)("code",{children:"[ ]"})," brackets are unique identifiers."]}),Object(R.jsxs)("ol",{type:"1",children:[Object(R.jsx)(Ke,{children:'Locate the unique identifier(s) for your book and input them in the tool on the "Input Manifest" page.'}),Object(R.jsxs)(Ke,{children:["After a short wait, you\u2019ll see a page that randomly mashes a sample of your book\u2019s pages together. This is normal! The purpose is to help you ",Object(R.jsx)("strong",{children:"find a spot in the resulting image that\u2019s just paper"})," (no text).",Object(R.jsx)("br",{})]}),Object(R.jsx)(Ke,{children:"Use your mouse to draw a small rectangle in a region that is likely to be blank on most pages. What\u2019ll soon happen in the background is that it\u2019ll calculate the average color at these coordinates on every single page in book (manifest, really). So you want it to be as uniform as possible (apples to apples, etc)."}),Object(R.jsxs)(Ke,{children:["Click \u201cUse this rectangle\u201d ",Object(R.jsx)("br",{}),Object(R.jsx)("a",{href:"demo_rect_select_small.gif",target:"_blank",children:"View demo of rectangle selection [opens in new window]"})]}),Object(R.jsx)(Ke,{children:"The next step is an optional filtering step. Maybe there are binding images or endpaper images you don\u2019t want. Maybe you\u2019ve accidentally captured a catchword or a signature mark. These will throw off your averages. You can delete or modify your rectangles one by one by clicking the delete button or the edit button on an individual image."}),Object(R.jsx)("a",{href:"demo_page_correct_small.gif",target:"_blank",children:"View demo of rectangle adjustment [opens in new window]"}),Object(R.jsx)(Ke,{children:Object(R.jsx)("p",{children:"Click \u201cView Plot\u201d or \u201cExtract Color Information.\u201d The plot on the left is keyed to images on the right. Click a point and see its associated image."})}),Object(R.jsx)(Ke,{children:Object(R.jsx)("p",{children:"Explore LUV, RGB, median, and mean permutations."})}),Object(R.jsx)(Ke,{children:Object(R.jsx)("p",{children:"Download your data. The tool doesn\u2019t currently store your history, so you won't be able to come back to this set of rectangle selections. Downloading your data is at present the only way to document your results and make them persist."})})]}),Object(R.jsx)(Ne,{level:2,id:"find-something-interesting-please-share",children:"Find Something Interesting? Please share!"}),Object(R.jsxs)("p",{children:["We love to hear about interesting examples! We\u2019d even love to use some examples in our papers. If you find something cool, by all means let us know. You can email us at cnwarren at cmu dot edu or tag us on Twitter ",Object(R.jsx)("span",{class:"citation","data-cites":"chrisvvarren",children:"@chrisvvarren"})," or ",Object(R.jsx)("span",{class:"citation","data-cites":"sammuellemey",children:"@sammuellemey"}),"."]}),Object(R.jsx)(Ne,{level:2,id:"for-libraries",children:"For Libraries"}),Object(R.jsx)("p",{children:"Want researchers to be able to use this tool for your collections? Make sure your IIIF platform has CORS enabled and let us know where we can find your manifests via the email addresses above."}),Object(R.jsx)(Ne,{level:2,id:"disclaimer",children:"Disclaimer"}),Object(R.jsx)("p",{children:"This tool is currently unpolished and a bit unstable.  (Max wrote it while sitting up with a sleepless infant, with all of the careful planning and attention to detail that implies.)  We welcome feedback about bugs or potential improvements, but are also currently limited in the time that we have available for development.  If you are comfortable with React and would like to contribute, let us know!"}),Object(R.jsx)(Ne,{level:2,id:"credits",children:"Credits"}),Object(R.jsxs)("p",{children:["Developed primarily by ",Object(R.jsx)("a",{href:"https://www.andrew.cmu.edu/user/mgsell/",children:"Max G\u2019Sell"})," with input from ",Object(R.jsx)("a",{href:"http://samuellemley.com/",children:"Samuel Lemley"}),", ",Object(R.jsx)("a",{href:"https://www.cmu.edu/dietrich/english/about-us/faculty/bios/warren-christopher.html",children:"Christopher Warren"}),", and ",Object(R.jsx)("a",{href:"http://matthewlincoln.net/",children:"Matthew Lincoln"})," as part of the Print & Probability research project. Intro and instructions by Chris Warren."]})]})}var et=p.a.div(Ve||(Ve=Object(j.a)(["\n/*position:fixed;*/\n/*top: 200px;*/\nleft: 0;\nright:0;\nheight:100%;\noverflow-y: scroll;\n"])));function tt(e){return console.log("Render App"),Object(R.jsx)("div",{className:"app",children:Object(R.jsxs)(m.a,{children:[Object(R.jsx)(U,{}),Object(R.jsx)(et,{children:Object(R.jsxs)(Oe.c,{children:[Object(R.jsx)(Oe.a,{exact:!0,path:"/",component:$e}),Object(R.jsx)(Oe.a,{path:"/manifest",component:C}),Object(R.jsx)(Oe.a,{path:"/rect",render:function(e){return Object(R.jsx)(ue,Object(h.a)({},e))}}),Object(R.jsx)(Oe.a,{path:"/scraps",render:function(e){return Object(R.jsx)(Le,Object(h.a)({},e))}}),Object(R.jsx)(Oe.a,{path:"/plot",render:function(e){return Object(R.jsx)(We,Object(h.a)({},e))}})]})})]})})}var nt=n(56),rt=Object(nt.b)({pages:Z,book:M}),it=Object(x.a)({reducer:rt});n(243),n(244);u.a.render(Object(R.jsx)(b.a,{store:it,children:Object(R.jsx)(tt,{})}),document.getElementById("root"))}},[[245,1,2]]]);
//# sourceMappingURL=main.14ffc451.chunk.js.map